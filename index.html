<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEOåŸºæœ¬è¨­å®š -->
    <title>ã‚†ã‚‹ãƒãƒ¼ã‚±é“å ´ - ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°å­¦ç¿’ã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒª | SEOãƒ»åºƒå‘Šãƒ»AIå•é¡Œã§å®ŸåŠ›ã‚¢ãƒƒãƒ—</title>
    <meta name="description" content="ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã‚¹ã‚­ãƒ«ã‚’æ¥½ã—ãå­¦ã¹ã‚‹ã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒªã€‚SEOã€åºƒå‘Šé‹ç”¨ã€AIæ´»ç”¨ãªã©å®Ÿè·µçš„ãªå•é¡Œã§çŸ¥è­˜ã‚’æ·±ã‚ã‚ˆã†ã€‚ç„¡æ–™ãƒ—ãƒ©ãƒ³ã‹ã‚‰å§‹ã‚ã‚‰ã‚Œã€ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã§ä¸Šç´šå•é¡Œã«ã‚‚æŒ‘æˆ¦å¯èƒ½ã€‚">
    <meta name="keywords" content="ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°,ã‚¯ã‚¤ã‚º,SEO,åºƒå‘Š,AI,å­¦ç¿’,ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—,ãƒ‡ã‚¸ã‚¿ãƒ«ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°,ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’">
    <meta name="author" content="ã‚†ã‚‹ãƒãƒ¼ã‚±é“å ´">
    <meta name="robots" content="index, follow">
    <meta name="language" content="ja">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://example.com/">
    <meta property="og:title" content="ã‚†ã‚‹ãƒãƒ¼ã‚±é“å ´ - ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°å­¦ç¿’ã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒª">
    <meta property="og:description" content="ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã‚¹ã‚­ãƒ«ã‚’æ¥½ã—ãå­¦ã¹ã‚‹ã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒªã€‚SEOã€åºƒå‘Šé‹ç”¨ã€AIæ´»ç”¨ãªã©å®Ÿè·µçš„ãªå•é¡Œã§çŸ¥è­˜ã‚’æ·±ã‚ã‚ˆã†ã€‚">
    <meta property="og:image" content="https://example.com/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="ã‚†ã‚‹ãƒãƒ¼ã‚±é“å ´">
    <meta property="og:locale" content="ja_JP">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://example.com/">
    <meta name="twitter:title" content="ã‚†ã‚‹ãƒãƒ¼ã‚±é“å ´ - ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°å­¦ç¿’ã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒª">
    <meta name="twitter:description" content="ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã‚¹ã‚­ãƒ«ã‚’æ¥½ã—ãå­¦ã¹ã‚‹ã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒªã€‚SEOã€åºƒå‘Šé‹ç”¨ã€AIæ´»ç”¨ãªã©å®Ÿè·µçš„ãªå•é¡Œã§çŸ¥è­˜ã‚’æ·±ã‚ã‚ˆã†ã€‚">
    <meta name="twitter:image" content="https://example.com/twitter-image.jpg">
    <meta name="twitter:creator" content="@yurumarket">
    
    <!-- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆJSON-LDï¼‰ -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "ã‚†ã‚‹ãƒãƒ¼ã‚±é“å ´",
        "description": "ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã‚¹ã‚­ãƒ«ã‚’æ¥½ã—ãå­¦ã¹ã‚‹ã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒªã€‚SEOã€åºƒå‘Šé‹ç”¨ã€AIæ´»ç”¨ãªã©å®Ÿè·µçš„ãªå•é¡Œã§çŸ¥è­˜ã‚’æ·±ã‚ã‚ˆã†ã€‚",
        "url": "https://example.com/",
        "applicationCategory": "EducationalApplication",
        "operatingSystem": "Web Browser",
        "offers": [
            {
                "@type": "Offer",
                "name": "ç„¡æ–™ãƒ—ãƒ©ãƒ³",
                "price": "0",
                "priceCurrency": "JPY",
                "description": "åˆç´šå•é¡Œã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½"
            },
            {
                "@type": "Offer",
                "name": "ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³",
                "price": "980",
                "priceCurrency": "JPY",
                "description": "å…¨é›£æ˜“åº¦ã®å•é¡Œã«ã‚¢ã‚¯ã‚»ã‚¹ã€è©³ç´°è§£èª¬ä»˜ã"
            }
        ],
        "author": {
            "@type": "Organization",
            "name": "ã‚†ã‚‹ãƒãƒ¼ã‚±é“å ´",
            "url": "https://example.com/"
        },
        "publisher": {
            "@type": "Organization",
            "name": "ã‚†ã‚‹ãƒãƒ¼ã‚±é“å ´",
            "url": "https://example.com/"
        },
        "inLanguage": "ja",
        "isAccessibleForFree": true,
        "hasPart": [
            {
                "@type": "Course",
                "name": "SEOåŸºç¤ã‚³ãƒ¼ã‚¹",
                "description": "æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³æœ€é©åŒ–ã®åŸºæœ¬ã‚’å­¦ã¶"
            },
            {
                "@type": "Course", 
                "name": "åºƒå‘Šé‹ç”¨ã‚³ãƒ¼ã‚¹",
                "description": "ãƒ‡ã‚¸ã‚¿ãƒ«åºƒå‘Šã®é‹ç”¨æ–¹æ³•ã‚’å­¦ã¶"
            },
            {
                "@type": "Course",
                "name": "AIæ´»ç”¨ã‚³ãƒ¼ã‚¹", 
                "description": "ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã§ã®AIæ´»ç”¨æ–¹æ³•ã‚’å­¦ã¶"
            }
        ]
    }
    </script>
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://example.com/">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXX" crossorigin="anonymous"></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>
    
    <!-- Google Sign-In API -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #00c4cc 0%, #7b68ee 50%, #ff6b9d 100%);
            min-height: 100vh;
        }
        .canva-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .quiz-card {
            background: linear-gradient(135deg, #00c4cc 0%, #7b68ee 100%);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }
        .quiz-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
            pointer-events: none;
        }
        .option-button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(0);
            border: 2px solid transparent;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            /* ã‚¿ãƒƒãƒæ“ä½œæœ€é©åŒ– */
            min-height: 44px; /* iOSæ¨å¥¨ã‚¿ãƒƒãƒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚µã‚¤ã‚º */
            touch-action: manipulation; /* ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã‚ºãƒ¼ãƒ ç„¡åŠ¹åŒ– */
            -webkit-tap-highlight-color: transparent; /* ã‚¿ãƒƒãƒ—ãƒã‚¤ãƒ©ã‚¤ãƒˆé™¤å» */
            user-select: none; /* ãƒ†ã‚­ã‚¹ãƒˆé¸æŠé˜²æ­¢ */
        }
        .option-button:hover,
        .option-button:focus {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(0, 196, 204, 0.3);
            border-color: #00c4cc;
            outline: none;
        }
        /* ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹ç”¨ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ */
        .option-button:active {
            transform: translateY(-1px);
            transition-duration: 0.1s;
        }
        /* ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        @media (max-width: 768px) {
            .option-button {
                min-height: 48px; /* ãƒ¢ãƒã‚¤ãƒ«ã§ã‚ˆã‚Šå¤§ããªã‚¿ãƒƒãƒã‚¿ãƒ¼ã‚²ãƒƒãƒˆ */
                font-size: 16px; /* iOSè‡ªå‹•ã‚ºãƒ¼ãƒ é˜²æ­¢ */
            }
        }
        .option-selected {
            background: linear-gradient(135deg, #00c4cc, #7b68ee) !important;
            color: white !important;
            border-color: #00c4cc !important;
        }
        .correct { 
            background: linear-gradient(135deg, #00d4aa, #00c4cc) !important; 
            animation: correctPulse 0.6s ease-out;
        }
        .incorrect { 
            background: linear-gradient(135deg, #ff6b9d, #ff8a80) !important; 
            animation: incorrectShake 0.6s ease-out;
        }
        .progress-bar {
            background: linear-gradient(90deg, #00c4cc, #7b68ee, #ff6b9d);
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }
        .canva-button {
            background: linear-gradient(135deg, #00c4cc, #7b68ee);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            /* ã‚¿ãƒƒãƒæ“ä½œæœ€é©åŒ– */
            min-height: 44px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        .canva-button:hover,
        .canva-button:focus {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 196, 204, 0.4);
            outline: 2px solid #00c4cc;
            outline-offset: 2px;
        }
        .canva-button:active {
            transform: translateY(0px);
            transition-duration: 0.1s;
        }
        @media (max-width: 768px) {
            .canva-button {
                min-height: 48px;
                font-size: 16px;
            }
        }
        .canva-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .canva-button:hover::before {
            left: 100%;
        }
        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        .shape {
            position: absolute;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }
        .shape:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; }
        .shape:nth-child(2) { top: 20%; right: 10%; animation-delay: 2s; }
        .shape:nth-child(3) { bottom: 20%; left: 20%; animation-delay: 4s; }
        .shape:nth-child(4) { bottom: 10%; right: 20%; animation-delay: 1s; }
        
        /* æ–°ã—ã„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        .slide-up {
            animation: slideUp 0.5s ease-out;
        }
        .bounce-in {
            animation: bounceIn 0.8s ease-out;
        }
        .pulse-glow {
            animation: pulseGlow 2s ease-in-out infinite;
        }
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ff6b9d;
            animation: confettiFall 3s linear infinite;
            z-index: 1000;
        }
        .confetti:nth-child(odd) { background: #00c4cc; }
        .confetti:nth-child(3n) { background: #7b68ee; }
        .confetti:nth-child(4n) { background: #00d4aa; }
        
        /* ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœ */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #fff;
            border-radius: 50%;
            pointer-events: none;
            animation: particleFloat 2s ease-out forwards;
        }
        
        /* SEOç”¨ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å°‚ç”¨ã‚¯ãƒ©ã‚¹ */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* ç´°ã‹ã„ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆå¯¾å¿œ */
        /* æ¥µå°ãƒ‡ãƒã‚¤ã‚¹ (320pxä»¥ä¸‹) */
        @media (max-width: 320px) {
            .container { padding: 8px; }
            .canva-card { padding: 12px; }
            .text-4xl { font-size: 1.875rem; }
            .text-3xl { font-size: 1.5rem; }
            .text-2xl { font-size: 1.25rem; }
        }
        
        /* å°å‹ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ (321px - 480px) */
        @media (min-width: 321px) and (max-width: 480px) {
            .container { padding: 12px; }
            .canva-card { padding: 16px; }
        }
        
        /* å¤§å‹ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ (481px - 768px) */
        @media (min-width: 481px) and (max-width: 768px) {
            .container { padding: 16px; }
            .canva-card { padding: 20px; }
        }
        
        /* å°å‹ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ (769px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container { padding: 20px; }
            .canva-card { padding: 24px; }
        }
        
        /* å¤§å‹ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»å°å‹ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ— (1025px - 1440px) */
        @media (min-width: 1025px) and (max-width: 1440px) {
            .container { padding: 24px; }
            .canva-card { padding: 32px; }
        }
        
        /* å¤§å‹ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ— (1441pxä»¥ä¸Š) */
        @media (min-width: 1441px) {
            .container { max-width: 1200px; }
            .canva-card { padding: 40px; }
        }
        
        /* æ¨ªå‘ãã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å¯¾å¿œ */
        @media (max-height: 500px) and (orientation: landscape) {
            .text-6xl { font-size: 2rem; }
            .text-5xl { font-size: 1.875rem; }
            .py-8 { padding-top: 1rem; padding-bottom: 1rem; }
            .mb-8 { margin-bottom: 1rem; }
        }
        
        /* åºƒå‘Šã‚¹ã‚¿ã‚¤ãƒ« */
        .ad-container {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            margin: 16px 0;
        }
        .ad-label {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        /* ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œãƒ»ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ”¹å–„ */
        /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¯èƒ½ãªè¦ç´ ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        button, input, select, textarea, [tabindex]:not([tabindex="-1"]) {
            outline: none;
        }
        
        /* é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒªãƒ³ã‚° */
        button:focus-visible, 
        input:focus-visible, 
        select:focus-visible, 
        textarea:focus-visible,
        [tabindex]:focus-visible {
            outline: 3px solid #0066cc;
            outline-offset: 2px;
            box-shadow: 0 0 0 1px #ffffff;
        }
        
        /* ãƒœã‚¿ãƒ³ã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ */
        .option-button:focus-visible {
            outline: 3px solid #0066cc;
            outline-offset: 2px;
            box-shadow: 0 0 0 1px #ffffff, 0 12px 40px rgba(0, 196, 204, 0.3);
            border-color: #00c4cc;
        }
        
        /* ã‚¹ã‚­ãƒƒãƒ—ãƒªãƒ³ã‚¯ */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: #000;
            color: #fff;
            padding: 8px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 1000;
            font-weight: bold;
        }
        .skip-link:focus {
            top: 6px;
        }
        
        /* é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆå¯¾å¿œ */
        @media (prefers-contrast: high) {
            .canva-card {
                border: 2px solid #000;
                background: #fff;
            }
            .option-button {
                border: 2px solid #000;
                background: #fff;
                color: #000;
            }
            .canva-button {
                background: #000;
                color: #fff;
                border: 2px solid #000;
            }
        }
        
        /* å‹•ãã‚’æ¸›ã‚‰ã™è¨­å®šã¸ã®å¯¾å¿œ */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            .floating-shapes {
                display: none;
            }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 196, 204, 0.3); }
            50% { box-shadow: 0 0 40px rgba(0, 196, 204, 0.6); }
        }
        @keyframes confettiFall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        @keyframes particleFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(0); opacity: 0; }
        }
        
        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-card: rgba(45, 45, 45, 0.95);
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --text-muted: #808080;
            --border-color: #404040;
            --accent-primary: #00c4cc;
            --accent-secondary: #7b68ee;
        }
        
        [data-theme="light"] {
            --bg-primary: linear-gradient(135deg, #00c4cc 0%, #7b68ee 50%, #ff6b9d 100%);
            --bg-secondary: #ffffff;
            --bg-card: rgba(255, 255, 255, 0.95);
            --text-primary: #1f2937;
            --text-secondary: #4b5563;
            --text-muted: #6b7280;
            --border-color: #e5e7eb;
            --accent-primary: #00c4cc;
            --accent-secondary: #7b68ee;
        }
        
        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã®bodyèƒŒæ™¯ */
        [data-theme="dark"] body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #404040 100%);
            color: var(--text-primary);
        }
        
        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã‚«ãƒ¼ãƒ‰ */
        [data-theme="dark"] .canva-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }
        
        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ãƒ†ã‚­ã‚¹ãƒˆ */
        [data-theme="dark"] .text-gray-800 { color: var(--text-primary) !important; }
        [data-theme="dark"] .text-gray-700 { color: var(--text-secondary) !important; }
        [data-theme="dark"] .text-gray-600 { color: var(--text-muted) !important; }
        [data-theme="dark"] .text-gray-500 { color: var(--text-muted) !important; }
        
        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ãƒœã‚¿ãƒ³ */
        [data-theme="dark"] .option-button {
            background: rgba(45, 45, 45, 0.9);
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        [data-theme="dark"] .option-button:hover {
            background: rgba(60, 60, 60, 0.9);
            border-color: var(--accent-primary);
        }
        
        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
        [data-theme="dark"] input, 
        [data-theme="dark"] select, 
        [data-theme="dark"] textarea {
            background: var(--bg-secondary);
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        [data-theme="dark"] input:focus,
        [data-theme="dark"] select:focus,
        [data-theme="dark"] textarea:focus {
            border-color: var(--accent-primary);
            background: rgba(45, 45, 45, 0.8);
        }
        
        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã®åºƒå‘Š */
        [data-theme="dark"] .ad-container {
            background: var(--bg-card);
            border-color: var(--border-color);
        }
        
        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ãƒ•ãƒƒã‚¿ãƒ¼ */
        [data-theme="dark"] footer {
            background: #0f0f0f;
        }
        
        /* ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 20px;
        }
        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 20px rgba(0, 196, 204, 0.3);
        }
        
        /* ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã«å¾“ã†å ´åˆã®åˆæœŸè¨­å®š */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #1a1a1a;
                --bg-secondary: #2d2d2d;
                --bg-card: rgba(45, 45, 45, 0.95);
                --text-primary: #ffffff;
                --text-secondary: #b3b3b3;
                --text-muted: #808080;
                --border-color: #404040;
                --accent-primary: #00c4cc;
                --accent-secondary: #7b68ee;
            }
        }
    </style>
</head>
<body>
    <!-- Floating Background Shapes -->
    <div class="floating-shapes">
        <div class="shape">
            <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                <circle cx="40" cy="40" r="30" fill="#00c4cc"/>
            </svg>
        </div>
        <div class="shape">
            <svg width="60" height="60" viewBox="0 0 60 60" fill="none">
                <rect x="15" y="15" width="30" height="30" rx="8" fill="#7b68ee"/>
            </svg>
        </div>
        <div class="shape">
            <svg width="70" height="70" viewBox="0 0 70 70" fill="none">
                <polygon points="35,10 55,50 15,50" fill="#ff6b9d"/>
            </svg>
        </div>
        <div class="shape">
            <svg width="50" height="50" viewBox="0 0 50 50" fill="none">
                <path d="M25 5 L45 25 L25 45 L5 25 Z" fill="#00d4aa"/>
            </svg>
        </div>
    </div>
    
    <!-- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£: ã‚¹ã‚­ãƒƒãƒ—ãƒªãƒ³ã‚¯ -->
    <a href="#main-content" class="skip-link">ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã‚¹ã‚­ãƒƒãƒ—</a>
    
    <!-- ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ" title="ãƒ†ãƒ¼ãƒã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹">
        <span id="themeIcon">ğŸŒ™</span>
    </button>
    
    <div class="container mx-auto px-4 py-8 max-w-4xl relative z-10" id="main-content">
        <!-- SEOç”¨ã®ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³å‘ã‘ï¼‰ -->
        <header class="sr-only">
            <h1>ã‚†ã‚‹ãƒãƒ¼ã‚±é“å ´ - ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°å­¦ç¿’ã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒª</h1>
            <p>SEOã€åºƒå‘Šé‹ç”¨ã€AIæ´»ç”¨ãªã©å®Ÿè·µçš„ãªãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°å•é¡Œã§çŸ¥è­˜ã‚’æ·±ã‚ã‚ˆã†</p>
        </header>

        <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
        <div id="loginContainer" class="canva-card rounded-3xl p-8 mb-8 text-center fade-in">
            <div class="mb-6">
                <h2 class="text-5xl font-bold bg-gradient-to-r from-cyan-500 to-purple-600 bg-clip-text text-transparent mb-3">
                    âœ¨ ã‚†ã‚‹ãƒãƒ¼ã‚±é“å ´
                </h2>
                <p class="text-gray-700 text-lg font-medium">40ä»£ä»¥ä¸Šã®éãƒãƒ¼ã‚±ã‚¿ãƒ¼ã€éãƒ‡ã‚¸ã‚¿ãƒ«ç¤¾ä¼šäººå‘ã‘ã®Webã‚¹ã‚­ãƒ«å­¦ç¿’ã‚µã‚¤ãƒˆ</p>
                
                <!-- å­¦ç¿’ã‚¤ãƒ¡ãƒ¼ã‚¸ -->
                <div class="my-8 flex justify-center">
                    <div class="relative">
                        <!-- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®SVGã‚¤ãƒ©ã‚¹ãƒˆ -->
                        <svg id="defaultIllustration" width="200" height="150" viewBox="0 0 200 150" class="rounded-lg shadow-lg">
                            <!-- èƒŒæ™¯ -->
                            <rect width="200" height="150" fill="#f0f9ff"/>
                            
                            <!-- ä¸­å¹´ç”·æ€§ï¼ˆç«‹ã£ã¦ã„ã‚‹å§¿å‹¢ï¼‰ -->
                            <!-- é ­ -->
                            <circle cx="60" cy="45" r="18" fill="#fbbf24"/>
                            <!-- é«ªï¼ˆè–„ã‚ã€Må­—ãƒã‚²é¢¨ï¼‰ -->
                            <path d="M 42 40 Q 50 32 60 32 Q 70 32 78 40 Q 75 35 70 35 Q 60 30 50 35 Q 45 35 42 40" fill="#6b7280"/>
                            <!-- çœ¼é¡ -->
                            <circle cx="55" cy="43" r="4" fill="none" stroke="#374151" stroke-width="1"/>
                            <circle cx="65" cy="43" r="4" fill="none" stroke="#374151" stroke-width="1"/>
                            <line x1="59" y1="43" x2="61" y2="43" stroke="#374151" stroke-width="1"/>
                            
                            <!-- ä½“ï¼ˆã‚·ãƒ£ãƒ„ï¼‰ -->
                            <rect x="48" y="63" width="24" height="45" rx="3" fill="#3b82f6"/>
                            <!-- è¥Ÿ -->
                            <polygon points="48,63 54,63 60,70 66,63 72,63 72,75 48,75" fill="#1e40af"/>
                            
                            <!-- å³è…•ï¼ˆã‚¹ãƒãƒ›ã‚’æŒã¤ï¼‰ -->
                            <rect x="72" y="70" width="8" height="25" rx="2" fill="#fbbf24"/>
                            <!-- å³æ‰‹ -->
                            <circle cx="80" cy="95" r="4" fill="#fbbf24"/>
                            
                            <!-- ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ï¼ˆæ‰‹ã«æŒã£ã¦ã„ã‚‹ï¼‰ -->
                            <rect x="82" y="85" width="25" height="40" rx="4" fill="#1f2937" stroke="#374151" stroke-width="1"/>
                            <rect x="85" y="90" width="19" height="30" fill="#3b82f6"/>
                            
                            <!-- ã‚¹ãƒãƒ›ç”»é¢ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
                            <rect x="87" y="93" width="15" height="3" rx="1" fill="#ffffff" opacity="0.9"/>
                            <rect x="87" y="98" width="12" height="2" rx="1" fill="#ffffff" opacity="0.7"/>
                            <rect x="87" y="102" width="13" height="2" rx="1" fill="#ffffff" opacity="0.7"/>
                            <rect x="87" y="106" width="10" height="2" rx="1" fill="#ffffff" opacity="0.7"/>
                            
                            <!-- é¸æŠè‚¢ãƒœã‚¿ãƒ³ -->
                            <rect x="87" y="110" width="15" height="3" rx="1" fill="#10b981" opacity="0.8"/>
                            <rect x="87" y="115" width="15" height="3" rx="1" fill="#ffffff" opacity="0.3"/>
                            
                            <!-- å·¦è…• -->
                            <rect x="40" y="75" width="8" height="20" rx="2" fill="#fbbf24"/>
                            <!-- å·¦æ‰‹ -->
                            <circle cx="40" cy="95" r="3" fill="#fbbf24"/>
                            
                            <!-- è„š -->
                            <rect x="52" y="108" width="7" height="25" rx="2" fill="#1f2937"/>
                            <rect x="61" y="108" width="7" height="25" rx="2" fill="#1f2937"/>
                            
                            <!-- é´ -->
                            <ellipse cx="55" cy="135" rx="6" ry="3" fill="#374151"/>
                            <ellipse cx="64" cy="135" rx="6" ry="3" fill="#374151"/>
                            
                            <!-- ç¬‘é¡” -->
                            <circle cx="56" cy="42" r="1" fill="#1f2937"/>
                            <circle cx="64" cy="42" r="1" fill="#1f2937"/>
                            <path d="M 54 50 Q 60 54 66 50" stroke="#1f2937" stroke-width="1.2" fill="none"/>
                            
                            <!-- å­¦ç¿’åŠ¹æœã®ã‚­ãƒ©ã‚­ãƒ© -->
                            <text x="120" y="25" font-size="16" fill="#fbbf24">âœ¨</text>
                            <text x="140" y="40" font-size="12" fill="#10b981">ğŸ’¡</text>
                            <text x="125" y="55" font-size="14" fill="#8b5cf6">ğŸ“š</text>
                            <text x="145" y="70" font-size="12" fill="#f59e0b">ğŸ¯</text>
                            
                            <!-- é›†ä¸­ç·šåŠ¹æœ -->
                            <line x1="110" y1="90" x2="115" y2="85" stroke="#fbbf24" stroke-width="2" opacity="0.6"/>
                            <line x1="115" y1="95" x2="120" y2="90" stroke="#fbbf24" stroke-width="2" opacity="0.6"/>
                            <line x1="110" y1="100" x2="115" y2="105" stroke="#fbbf24" stroke-width="2" opacity="0.6"/>
                            
                            <!-- ã€Œæ¥½ã—ãå­¦ç¿’ä¸­ã€ãƒ†ã‚­ã‚¹ãƒˆ -->
                            <text x="100" y="140" font-size="10" fill="#6b7280" text-anchor="middle">æ¥½ã—ãå­¦ç¿’ä¸­ï¼</text>
                        </svg>
                        
                        <!-- ã‚«ã‚¹ã‚¿ãƒ ç”»åƒï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰ -->
                        <img id="customHeroImage" src="" alt="å­¦ç¿’ã‚¤ãƒ¡ãƒ¼ã‚¸" class="hidden rounded-lg shadow-lg w-[200px] h-[150px] object-cover">
                        
                        <!-- ç®¡ç†è€…ã®ã¿ï¼šç”»åƒå¤‰æ›´ãƒœã‚¿ãƒ³ -->
                        <button id="changeImageButton" onclick="showImageUploadModal()" class="hidden absolute -bottom-2 -right-2 bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-full shadow-lg transition-all text-xs">
                            ğŸ“·
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- åºƒå‘Šã‚¹ãƒšãƒ¼ã‚¹1 -->
            <div class="ad-container mb-6">
                <div class="ad-label">ã‚¹ãƒãƒ³ã‚µãƒ¼</div>
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-lg">
                    <h3 class="font-bold mb-2">ğŸ“š å­¦ç¿’åŠ¹ç‡UPï¼</h3>
                    <p class="text-sm">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã§è©³ç´°è§£èª¬ã¨é€²æ—åˆ†æã‚’ä½“é¨“</p>
                </div>
            </div>
            
            <div class="max-w-md mx-auto">
                <div class="mb-6">
                    <input type="email" id="loginEmail" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent mb-3">
                    <input type="password" id="loginPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                
                <div class="space-y-3">
                    <button onclick="login()" class="canva-button text-white px-8 py-3 rounded-2xl font-semibold w-full shadow-lg">
                        ğŸ”‘ ãƒ­ã‚°ã‚¤ãƒ³
                    </button>
                    <button onclick="googleLogin()" class="bg-red-500 hover:bg-red-600 text-white px-8 py-3 rounded-2xl font-semibold w-full shadow-lg transition-all flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        Googleã§ãƒ­ã‚°ã‚¤ãƒ³
                    </button>
                    <button onclick="showRegister()" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-2xl font-semibold w-full shadow-lg transition-all">
                        ğŸ“ æ–°è¦ç™»éŒ²
                    </button>
                    <button onclick="loginAsGuest()" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-2xl font-semibold w-full shadow-lg transition-all">
                        ğŸ‘¤ ã‚²ã‚¹ãƒˆãƒ­ã‚°ã‚¤ãƒ³ï¼ˆç„¡æ–™ãƒ—ãƒ©ãƒ³ï¼‰
                    </button>
                </div>
                
                <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                    <h3 class="font-semibold text-blue-800 mb-2">ğŸ’¡ ãƒ‡ãƒ¢ç”¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</h3>
                    <div class="text-sm text-blue-700 space-y-1">
                        <p><strong>ç„¡æ–™ãƒ—ãƒ©ãƒ³:</strong> demo@free.com / password123</p>
                        <p><strong>ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³:</strong> demo@premium.com / password123</p>
                        <p><strong>ç®¡ç†è€…:</strong> admin@demo.com / admin123</p>
                        <p><strong>Googleãƒ­ã‚°ã‚¤ãƒ³:</strong> ã€ŒGoogleã§ãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼ˆãƒ‡ãƒ¢ç‰ˆï¼‰</p>
                    </div>
                    <div class="mt-3 p-2 bg-green-50 rounded text-xs text-green-700">
                        âœ¨ <strong>æ–°æ©Ÿèƒ½:</strong> ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ãŒãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚ä¿æŒã•ã‚Œã¾ã™
                    </div>
                </div>
            </div>
        </div>

        <!-- æ–°è¦ç™»éŒ²ç”»é¢ -->
        <div id="registerContainer" class="hidden canva-card rounded-3xl p-8 mb-8 text-center fade-in">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">ğŸ“ æ–°è¦ç™»éŒ²</h2>
            
            <div class="max-w-md mx-auto">
                <div class="mb-6 space-y-3">
                    <input type="text" id="registerName" placeholder="ãŠåå‰" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <input type="email" id="registerEmail" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <input type="password" id="registerPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                
                <div class="space-y-3">
                    <button onclick="register()" class="canva-button text-white px-8 py-3 rounded-2xl font-semibold w-full shadow-lg">
                        âœ¨ ç™»éŒ²ã™ã‚‹ï¼ˆç„¡æ–™ãƒ—ãƒ©ãƒ³ï¼‰
                    </button>
                    <button onclick="showLogin()" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-2xl font-semibold w-full shadow-lg transition-all">
                        â† ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹
                    </button>
                </div>
            </div>
        </div>

        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ­ã‚°ã‚¤ãƒ³å¾Œï¼‰ -->
        <div id="mainHeader" class="hidden">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-4 sm:space-y-0">
                <div class="canva-card rounded-2xl px-4 sm:px-8 py-4 sm:py-6 fade-in w-full sm:w-auto">
                    <h1 class="text-2xl sm:text-4xl font-bold bg-gradient-to-r from-cyan-500 to-purple-600 bg-clip-text text-transparent mb-1 sm:mb-2">
                        âœ¨ ã‚†ã‚‹ãƒãƒ¼ã‚±é“å ´
                    </h1>
                    <p class="text-gray-700 text-sm sm:text-lg font-medium">40ä»£ä»¥ä¸Šã®éãƒãƒ¼ã‚±ã‚¿ãƒ¼ã€éãƒ‡ã‚¸ã‚¿ãƒ«ç¤¾ä¼šäººå‘ã‘ã®Webã‚¹ã‚­ãƒ«å­¦ç¿’ã‚µã‚¤ãƒˆ</p>
                </div>
                
                <div class="canva-card rounded-2xl px-3 sm:px-6 py-3 sm:py-4 fade-in w-full sm:w-auto">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4">
                        <div class="flex-1 sm:text-right">
                            <div class="font-semibold text-gray-800 text-sm sm:text-base" id="userNameDisplay">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</div>
                            <div class="flex items-center justify-start sm:justify-end mt-1">
                                <span id="userPlanDisplay" class="text-xs sm:text-sm px-2 sm:px-3 py-1 rounded-full bg-blue-100 text-blue-600">ç„¡æ–™ãƒ—ãƒ©ãƒ³</span>
                                <button id="upgradeButton" onclick="showUpgradeModal()" class="hidden ml-2 text-xs bg-gradient-to-r from-purple-500 to-pink-500 text-white px-2 sm:px-3 py-1 rounded-full hover:shadow-lg transition-all">
                                    â­ ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
                                </button>
                            </div>
                        </div>
                        <div class="flex space-x-2 w-full sm:w-auto">
                            <button id="adminButton" onclick="showAdminPanel()" class="hidden flex-1 sm:flex-none bg-purple-500 hover:bg-purple-600 text-white px-3 sm:px-4 py-2 rounded-lg font-medium transition-all text-xs sm:text-sm">
                                âš™ï¸ ç®¡ç†
                            </button>
                            <button onclick="showAnalytics()" class="flex-1 sm:flex-none bg-blue-500 hover:bg-blue-600 text-white px-3 sm:px-4 py-2 rounded-lg font-medium transition-all text-xs sm:text-sm">
                                ğŸ“Š åˆ†æ
                            </button>
                            <button onclick="logout()" class="flex-1 sm:flex-none bg-red-500 hover:bg-red-600 text-white px-3 sm:px-4 py-2 rounded-lg font-medium transition-all text-xs sm:text-sm">
                                ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ -->
        <main id="homeContainer" class="hidden">
            <!-- ã‚¦ã‚§ãƒ«ã‚«ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <section class="canva-card rounded-3xl p-6 sm:p-8 mb-6 text-center fade-in">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row items-center justify-center gap-6 mb-6">
                        <div class="flex-1">
                            <div class="text-4xl sm:text-6xl mb-4">ğŸ </div>
                            <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°å­¦ç¿’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
                            <p class="text-gray-600 text-sm sm:text-base">40ä»£ä»¥ä¸Šã®éãƒãƒ¼ã‚±ã‚¿ãƒ¼ã€éãƒ‡ã‚¸ã‚¿ãƒ«ç¤¾ä¼šäººå‘ã‘ã®Webã‚¹ã‚­ãƒ«å­¦ç¿’ã‚µã‚¤ãƒˆ</p>
                        </div>
                        
                        <!-- å­¦ç¿’ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆãƒ›ãƒ¼ãƒ ç”»é¢ç”¨ï¼‰ -->
                        <div class="flex-shrink-0">
                            <svg width="180" height="140" viewBox="0 0 180 140" class="rounded-lg shadow-lg">
                                <!-- èƒŒæ™¯ -->
                                <rect width="180" height="140" fill="#f8fafc"/>
                                
                                <!-- ãƒ‡ã‚¹ã‚¯ -->
                                <rect x="20" y="100" width="140" height="30" rx="4" fill="#8b5cf6" opacity="0.8"/>
                                
                                <!-- ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ -->
                                <rect x="60" y="70" width="45" height="70" rx="6" fill="#1f2937" stroke="#374151" stroke-width="1.5"/>
                                <rect x="64" y="78" width="37" height="54" fill="#3b82f6"/>
                                
                                <!-- ã‚¹ãƒãƒ›ç”»é¢ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
                                <rect x="68" y="82" width="29" height="6" rx="1" fill="#ffffff" opacity="0.9"/>
                                <rect x="68" y="92" width="22" height="4" rx="1" fill="#ffffff" opacity="0.7"/>
                                <rect x="68" y="99" width="26" height="4" rx="1" fill="#ffffff" opacity="0.7"/>
                                <rect x="68" y="106" width="18" height="4" rx="1" fill="#ffffff" opacity="0.7"/>
                                
                                <!-- é¸æŠè‚¢ãƒœã‚¿ãƒ³ -->
                                <rect x="68" y="114" width="29" height="6" rx="1" fill="#10b981" opacity="0.8"/>
                                <rect x="68" y="122" width="29" height="6" rx="1" fill="#ffffff" opacity="0.3"/>
                                
                                <!-- ä¸­å¹´ç”·æ€§ï¼ˆåº§ã£ã¦ã„ã‚‹ï¼‰ -->
                                <!-- é ­ -->
                                <circle cx="40" cy="60" r="12" fill="#fbbf24"/>
                                <!-- é«ªï¼ˆè–„ã‚ã€ã‚µã‚¤ãƒ‰åˆ†ã‘ï¼‰ -->
                                <path d="M 28 55 Q 40 48 52 55 Q 48 52 40 52 Q 32 52 28 55" fill="#6b7280"/>
                                <!-- ä½“ -->
                                <rect x="32" y="72" width="16" height="28" rx="2" fill="#059669"/>
                                <!-- è…•ï¼ˆã‚¹ãƒãƒ›ã‚’æŒã¤ï¼‰ -->
                                <rect x="48" y="78" width="12" height="6" rx="1" fill="#fbbf24"/>
                                <rect x="20" y="82" width="12" height="6" rx="1" fill="#fbbf24"/>
                                
                                <!-- è„š -->
                                <rect x="30" y="100" width="6" height="15" rx="1" fill="#1f2937"/>
                                <rect x="42" y="100" width="6" height="15" rx="1" fill="#1f2937"/>
                                
                                <!-- ç¬‘é¡” -->
                                <circle cx="36" cy="58" r="1" fill="#1f2937"/>
                                <circle cx="44" cy="58" r="1" fill="#1f2937"/>
                                <path d="M 34 64 Q 40 67 46 64" stroke="#1f2937" stroke-width="1" fill="none"/>
                                
                                <!-- ã‚³ãƒ¼ãƒ’ãƒ¼ã‚«ãƒƒãƒ— -->
                                <rect x="110" y="85" width="12" height="15" rx="2" fill="#ffffff" stroke="#d1d5db"/>
                                <rect x="112" y="87" width="8" height="11" fill="#8b4513" opacity="0.6"/>
                                <path d="M 122 90 Q 127 90 127 95 Q 127 100 122 100" stroke="#d1d5db" fill="none"/>
                                
                                <!-- å­¦ç¿’åŠ¹æœã®ã‚­ãƒ©ã‚­ãƒ© -->
                                <text x="130" y="25" font-size="14" fill="#fbbf24">âœ¨</text>
                                <text x="145" y="40" font-size="10" fill="#10b981">ğŸ’¡</text>
                                <text x="135" y="55" font-size="12" fill="#8b5cf6">ğŸ“ˆ</text>
                                <text x="150" y="70" font-size="10" fill="#f59e0b">ğŸ¯</text>
                                
                                <!-- ã€Œé›†ä¸­å­¦ç¿’ä¸­ã€ãƒ†ã‚­ã‚¹ãƒˆ -->
                                <text x="90" y="130" font-size="9" fill="#6b7280" text-anchor="middle">é›†ä¸­å­¦ç¿’ä¸­ï¼</text>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <!-- Phase 2: ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ - ãƒ¬ãƒ™ãƒ«ãƒ»XPãƒãƒ¼ -->
                <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-4 sm:p-6 rounded-2xl mb-6 shadow-lg">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <div class="text-2xl sm:text-3xl mr-3">â­</div>
                            <div>
                                <div class="text-lg sm:text-xl font-bold" id="userLevelDisplay">Lv.1</div>
                                <div class="text-xs sm:text-sm opacity-90" id="userXPDisplay">0 / 100 XP</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm opacity-90">ç·XP</div>
                            <div class="text-lg font-bold" id="totalXPDisplay">0</div>
                        </div>
                    </div>
                    <div class="w-full bg-white bg-opacity-20 rounded-full h-3">
                        <div id="xpProgressBar" class="bg-white rounded-full h-3 transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- ä»Šæ—¥ã®ç›®æ¨™ -->
                <div class="canva-card rounded-2xl p-4 sm:p-6 mb-6">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">ğŸ¯</span>
                        ä»Šæ—¥ã®ç›®æ¨™
                    </h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4" id="dailyGoalsContainer">
                        <!-- ç›®æ¨™ãŒã“ã“ã«å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                    </div>
                </div>
                
                <!-- å­¦ç¿’çµ±è¨ˆã‚µãƒãƒªãƒ¼ -->
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 mb-6">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-3 sm:p-4 rounded-xl text-center">
                        <div class="text-lg sm:text-2xl font-bold" id="homeTotalQuizzes">0</div>
                        <div class="text-xs sm:text-sm opacity-90">ç·ã‚¯ã‚¤ã‚ºæ•°</div>
                    </div>
                    <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-3 sm:p-4 rounded-xl text-center">
                        <div class="text-lg sm:text-2xl font-bold" id="homeAverageScore">0%</div>
                        <div class="text-xs sm:text-sm opacity-90">å¹³å‡æ­£ç­”ç‡</div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-3 sm:p-4 rounded-xl text-center">
                        <div class="text-lg sm:text-2xl font-bold" id="homeStreak">0æ—¥</div>
                        <div class="text-xs sm:text-sm opacity-90">é€£ç¶šå­¦ç¿’</div>
                        <div class="text-xs opacity-75 mt-1">æœ€é«˜: <span id="homeBestStreak">0</span>æ—¥</div>
                    </div>
                    <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-3 sm:p-4 rounded-xl text-center">
                        <div class="text-lg sm:text-2xl font-bold" id="homeLevel">Lv.1</div>
                        <div class="text-xs sm:text-sm opacity-90">ç¾åœ¨ãƒ¬ãƒ™ãƒ«</div>
                    </div>
                </div>
                
                <!-- æœ€è¿‘ç²å¾—ã—ãŸãƒãƒƒã‚¸ -->
                <div class="canva-card rounded-2xl p-4 sm:p-6 mb-6" id="recentBadgesSection">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">ğŸ†</span>
                        æœ€è¿‘ã®ãƒãƒƒã‚¸
                        <button onclick="showAllBadges()" class="ml-auto text-sm bg-blue-500 text-white px-3 py-1 rounded-full hover:bg-blue-600 transition-all">
                            ã™ã¹ã¦è¦‹ã‚‹
                        </button>
                    </h3>
                    <div id="recentBadgesContainer" class="flex flex-wrap gap-3">
                        <!-- æœ€è¿‘ã®ãƒãƒƒã‚¸ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                    </div>
                </div>
                
                <!-- åºƒå‘Šã‚¹ãƒšãƒ¼ã‚¹ï¼ˆãƒ›ãƒ¼ãƒ ç”»é¢ä¸Šéƒ¨ï¼‰ -->
                <div id="homeAdSpace1" class="ad-container mb-6">
                    <div class="ad-label">ãŠã™ã™ã‚</div>
                    <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-4 rounded-lg">
                        <h3 class="font-bold mb-2 text-sm sm:text-base">ğŸ¯ å­¦ç¿’åŠ¹ç‡ã‚’æœ€å¤§åŒ–ï¼</h3>
                        <p class="text-xs sm:text-sm">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã§è©³ç´°è§£èª¬ã¨é«˜åº¦åˆ†ææ©Ÿèƒ½ã‚’ä½“é¨“</p>
                        <button onclick="showUpgradeModal()" class="mt-2 bg-white text-indigo-600 px-3 py-1 rounded-full text-xs font-medium hover:shadow-lg transition-all">
                            ä»Šã™ãã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ã‚«ãƒ†ã‚´ãƒªé¸æŠ -->
            <section class="canva-card rounded-3xl p-6 sm:p-8 mb-6 fade-in">
                <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-6 text-center">ğŸ“š ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°å­¦ç¿’ã‚«ãƒ†ã‚´ãƒª</h3>
                <p class="text-center text-gray-600 mb-6 text-sm sm:text-base">å®Ÿè·µçš„ãªãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ã‚ˆã†</p>
                <div id="categoryGrid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4">
                    <!-- ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                </div>
            </section>
            
            <!-- æœ€è¿‘ã®å­¦ç¿’å±¥æ­´ -->
            <section class="canva-card rounded-3xl p-6 sm:p-8 mb-6 fade-in">
                <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-6">ğŸ“ˆ å­¦ç¿’é€²æ—ã¨å±¥æ­´</h3>
                <p class="text-gray-600 mb-4 text-sm sm:text-base">ã‚ãªãŸã®ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°å­¦ç¿’ã®æˆæœã‚’ç¢ºèªã—ã‚ˆã†</p>
                <div id="recentHistory" class="space-y-3">
                    <!-- å­¦ç¿’å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
            </section>
            
            <!-- åºƒå‘Šã‚¹ãƒšãƒ¼ã‚¹ï¼ˆãƒ›ãƒ¼ãƒ ç”»é¢ä¸‹éƒ¨ï¼‰ -->
            <div id="homeAdSpace2" class="ad-container mb-6">
                <div class="ad-label">ã‚¹ãƒãƒ³ã‚µãƒ¼</div>
                <div class="bg-gradient-to-r from-pink-500 to-rose-600 text-white p-4 rounded-lg">
                    <h3 class="font-bold mb-2 text-sm sm:text-base">ğŸ† ã•ã‚‰ãªã‚‹é«˜ã¿ã¸</h3>
                    <p class="text-xs sm:text-sm">ä¸Šç´šå•é¡Œã§çœŸã®ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚’ç›®æŒ‡ãã†</p>
                </div>
            </div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
        <div id="analyticsContainer" class="hidden canva-card rounded-3xl p-8 mb-8 fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-gray-800">ğŸ“Š å­¦ç¿’åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
                <button onclick="hideAnalytics()" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg transition-all">
                    â† æˆ»ã‚‹
                </button>
            </div>
            
            <!-- çµ±è¨ˆã‚µãƒãƒªãƒ¼ -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-2xl text-center">
                    <div class="text-3xl font-bold" id="totalQuizzes">0</div>
                    <div class="text-sm opacity-90">ç·ã‚¯ã‚¤ã‚ºæ•°</div>
                </div>
                <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-2xl text-center">
                    <div class="text-3xl font-bold" id="averageScore">0%</div>
                    <div class="text-sm opacity-90">å¹³å‡æ­£ç­”ç‡</div>
                </div>
                <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-2xl text-center">
                    <div class="text-3xl font-bold" id="totalTime">0åˆ†</div>
                    <div class="text-sm opacity-90">ç·å­¦ç¿’æ™‚é–“</div>
                </div>
                <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-6 rounded-2xl text-center">
                    <div class="text-3xl font-bold" id="streak">0æ—¥</div>
                    <div class="text-sm opacity-90">é€£ç¶šå­¦ç¿’æ—¥æ•°</div>
                </div>
            </div>
            
            <!-- ãƒãƒ£ãƒ¼ãƒˆ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“ˆ æ­£ç­”ç‡ã®æ¨ç§»</h3>
                    <canvas id="scoreChart" width="400" height="200"></canvas>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“Š ã‚«ãƒ†ã‚´ãƒªåˆ¥æˆç¸¾</h3>
                    <canvas id="categoryChart" width="400" height="200"></canvas>
                </div>
            </div>
            
            <!-- è©³ç´°åˆ†æ -->
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ¯ å¼±ç‚¹åˆ†æ</h3>
                <div id="weaknessAnalysis" class="space-y-4">
                    <!-- å¼±ç‚¹åˆ†æãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
            </div>
            
            <!-- åºƒå‘Šã‚¹ãƒšãƒ¼ã‚¹2 -->
            <div class="ad-container mt-8">
                <div class="ad-label">ãŠã™ã™ã‚</div>
                <div class="bg-gradient-to-r from-green-500 to-teal-600 text-white p-4 rounded-lg">
                    <h3 class="font-bold mb-2">ğŸš€ å­¦ç¿’åŠ¹ç‡ã‚’æœ€å¤§åŒ–</h3>
                    <p class="text-sm">AIåˆ†æã«ã‚ˆã‚‹å€‹åˆ¥å­¦ç¿’ãƒ—ãƒ©ãƒ³ã§æˆç¸¾å‘ä¸Šã‚’å®Ÿç¾</p>
                </div>
            </div>
        </div>

        <!-- ç®¡ç†è€…ç”»é¢ -->
        <div id="adminContainer" class="hidden canva-card rounded-3xl p-6 sm:p-8 mb-8 fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-800">âš™ï¸ ç®¡ç†è€…ç”»é¢</h2>
                <button onclick="hideAdminPanel()" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg transition-all">
                    â† æˆ»ã‚‹
                </button>
            </div>
            
            <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆèª­ã¿è¾¼ã¿ -->
            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“Š ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å•é¡Œã‚’èª­ã¿è¾¼ã¿</h3>
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <h4 class="font-semibold text-blue-800 mb-2">ğŸ“‹ ãƒ‡ãƒ¼ã‚¿å½¢å¼</h4>
                    <p class="text-blue-700 text-sm mb-3">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¯ä»¥ä¸‹ã®åˆ—æ§‹æˆã§ä½œæˆã—ã¦ãã ã•ã„ï¼š</p>
                    <div class="bg-white p-3 rounded border text-xs font-mono">
                        Aåˆ—: å•é¡Œæ–‡ | Båˆ—: ã‚¿ã‚¤ãƒ—(single/multiple/truefalse) | Cåˆ—: é¸æŠè‚¢(ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š) | Dåˆ—: æ­£è§£(ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š) | Eåˆ—: ã‚«ãƒ†ã‚´ãƒª | Fåˆ—: é›£æ˜“åº¦ | Gåˆ—: è§£èª¬
                    </div>
                    <p class="text-blue-600 text-sm mt-2">
                        âš ï¸ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ã€Œãƒªãƒ³ã‚¯ã‚’çŸ¥ã£ã¦ã„ã‚‹å…¨å“¡ãŒé–²è¦§å¯èƒ½ã€ã«è¨­å®šã—ã¦ãã ã•ã„
                    </p>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURL</label>
                        <input type="url" id="spreadsheetUrl" placeholder="https://docs.google.com/spreadsheets/d/..." 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="loadFromSpreadsheet()" class="canva-button text-white px-6 py-3 rounded-lg font-semibold shadow-lg">
                            ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
                        </button>
                        <button onclick="refreshSpreadsheetData()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transition-all">
                            ğŸ”„ ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
                        </button>
                        <button onclick="loadSampleData()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transition-all">
                            ğŸ¯ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
                        </button>
                    </div>
                </div>
                
                <!-- èª­ã¿è¾¼ã¿çŠ¶æ³ -->
                <div id="loadingMessage" class="hidden mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <div class="flex items-center">
                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-600 mr-3"></div>
                        <span class="text-yellow-700">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</span>
                    </div>
                </div>
                
                <!-- æ¤œè¨¼çµæœ -->
                <div id="validationResults" class="hidden mt-4"></div>
            </div>
            
            <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆ -->
            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆ</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-600" id="adminTotalUsers">0</div>
                        <div class="text-sm text-blue-600">ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600" id="adminTodayLogins">0</div>
                        <div class="text-sm text-green-600">ä»Šæ—¥ã®ãƒ­ã‚°ã‚¤ãƒ³</div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-purple-600" id="adminWeeklyLogins">0</div>
                        <div class="text-sm text-purple-600">ä»Šé€±ã®ãƒ­ã‚°ã‚¤ãƒ³</div>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-orange-600" id="adminPremiumUsers">0</div>
                        <div class="text-sm text-orange-600">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼</div>
                    </div>
                </div>
                
                <!-- ãƒ—ãƒ©ãƒ³åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-800 mb-3">ãƒ—ãƒ©ãƒ³åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</h4>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="text-center">
                            <div class="text-lg font-bold text-blue-600" id="adminFreeUsers">0</div>
                            <div class="text-xs text-gray-600">ç„¡æ–™ãƒ—ãƒ©ãƒ³</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-purple-600" id="adminPremiumUsersDetail">0</div>
                            <div class="text-xs text-gray-600">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-red-600" id="adminAdminUsers">0</div>
                            <div class="text-xs text-gray-600">ç®¡ç†è€…</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿çŠ¶æ³ -->
            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“ˆ ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿çŠ¶æ³</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-600" id="adminTotalQuestions">0</div>
                        <div class="text-sm text-blue-600">ç·å•é¡Œæ•°</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600" id="adminTotalCategories">0</div>
                        <div class="text-sm text-green-600">ã‚«ãƒ†ã‚´ãƒªæ•°</div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-purple-600" id="adminLastUpdate">æœªæ›´æ–°</div>
                        <div class="text-sm text-purple-600">æœ€çµ‚æ›´æ–°</div>
                    </div>
                </div>
            </div>
            
            <!-- ã‚«ãƒ†ã‚´ãƒªåˆ¥å•é¡Œæ•° -->
            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“š ã‚«ãƒ†ã‚´ãƒªåˆ¥å•é¡Œæ•°</h3>
                <div id="adminCategoryBreakdown" class="space-y-2">
                    <!-- ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ‡ãƒ¼ã‚¿ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
            </div>
            
            <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç† -->
            <div>
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ—‚ï¸ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
                <div class="flex flex-wrap gap-3">
                    <button onclick="exportData()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-all">
                        ğŸ“¤ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                    </button>
                    <button onclick="clearAllData()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-all">
                        ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
                    </button>
                    <button onclick="resetToSample()" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-medium transition-all">
                        ğŸ”„ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã«ãƒªã‚»ãƒƒãƒˆ
                    </button>
                </div>
            </div>
        </div>

        <!-- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="imageUploadModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="canva-card rounded-3xl p-6 sm:p-8 max-w-md mx-4 bounce-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 flex items-center">
                        <span class="text-2xl mr-3">ğŸ“·</span>
                        ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒã®å¤‰æ›´
                    </h2>
                    <button onclick="closeImageUploadModal()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ç”»åƒURL</label>
                        <input type="url" id="heroImageUrl" placeholder="https://example.com/image.jpg" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <p class="text-xs text-gray-500 mt-1">æ¨å¥¨ã‚µã‚¤ã‚º: 200Ã—150px ã¾ãŸã¯åŒæ¯”ç‡</p>
                    </div>
                    
                    <div class="space-y-3">
                        <button onclick="updateHeroImage()" class="canva-button text-white px-6 py-3 rounded-lg font-semibold w-full shadow-lg">
                            ğŸ–¼ï¸ ç”»åƒã‚’è¨­å®š
                        </button>
                        <button onclick="resetToDefaultImage()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold w-full shadow-lg transition-all">
                            ğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
                        </button>
                        <button onclick="closeImageUploadModal()" class="bg-gray-400 hover:bg-gray-500 text-white px-6 py-3 rounded-lg font-semibold w-full shadow-lg transition-all">
                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒãƒƒã‚¸ä¸€è¦§ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="badgeModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="canva-card rounded-3xl p-6 sm:p-8 max-w-4xl mx-4 max-h-[80vh] overflow-y-auto bounce-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 flex items-center">
                        <span class="text-3xl mr-3">ğŸ†</span>
                        ãƒãƒƒã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
                    </h2>
                    <button onclick="closeBadgeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                </div>
                
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-lg font-semibold text-gray-700">
                            ç²å¾—æ¸ˆã¿: <span id="earnedBadgeCount">0</span> / <span id="totalBadgeCount">15</span>
                        </div>
                        <div class="text-sm text-gray-500">
                            ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆç‡: <span id="badgeCompletionRate">0%</span>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="badgeProgressBar" class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full h-2 transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4" id="allBadgesContainer">
                    <!-- å…¨ãƒãƒƒã‚¸ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
            </div>
        </div>

        <!-- ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="upgradeModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="canva-card rounded-3xl p-8 max-w-md mx-4 bounce-in">
                <div class="text-center">
                    <div class="text-6xl mb-4">â­</div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</h2>
                    <p class="text-gray-600 mb-6">ä¸­ç´šãƒ»ä¸Šç´šå•é¡Œã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ã•ã‚‰ãªã‚‹ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã‚’ï¼</p>
                    
                    <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-2xl p-6 mb-6 pulse-glow">
                        <div class="text-4xl font-bold mb-2">Â¥980</div>
                        <div class="text-lg">æœˆé¡</div>
                    </div>
                    
                    <div class="text-left mb-6 space-y-2">
                        <div class="flex items-center">
                            <span class="text-green-500 mr-2">âœ“</span>
                            <span>å…¨é›£æ˜“åº¦ã®å•é¡Œã«ã‚¢ã‚¯ã‚»ã‚¹</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-green-500 mr-2">âœ“</span>
                            <span>è©³ç´°ãªè§£èª¬ä»˜ã</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-green-500 mr-2">âœ“</span>
                            <span>é«˜åº¦ãªå­¦ç¿’åˆ†ææ©Ÿèƒ½</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-green-500 mr-2">âœ“</span>
                            <span>åºƒå‘Šéè¡¨ç¤º</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-green-500 mr-2">âœ“</span>
                            <span>å„ªå…ˆã‚µãƒãƒ¼ãƒˆ</span>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <button onclick="upgradeToPremium()" class="canva-button text-white px-8 py-3 rounded-2xl font-semibold w-full shadow-lg">
                            ğŸ’³ ä»Šã™ãã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
                        </button>
                        <button onclick="closeUpgradeModal()" class="bg-gray-400 hover:bg-gray-500 text-white px-8 py-3 rounded-2xl font-semibold w-full shadow-lg transition-all">
                            å¾Œã§
                        </button>
                    </div>
                    
                    <p class="text-xs text-gray-500 mt-4">â€» ãƒ‡ãƒ¢ç‰ˆã§ã¯å®Ÿéš›ã®èª²é‡‘ã¯ç™ºç”Ÿã—ã¾ã›ã‚“</p>
                </div>
            </div>
        </div>

        <!-- ã‚¯ã‚¤ã‚ºè¨­å®šãƒ‘ãƒãƒ«ï¼ˆãƒ›ãƒ¼ãƒ ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ï¼‰ -->
        <div id="setupPanel" class="hidden canva-card rounded-3xl p-6 sm:p-8 mb-8 fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl sm:text-2xl font-semibold text-gray-800">âš™ï¸ ã‚¯ã‚¤ã‚ºè¨­å®š</h2>
                <button onclick="showHome()" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg transition-all text-sm">
                    â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
                </button>
            </div>
            
            <div class="space-y-4">
                <!-- ã‚¯ã‚¤ã‚ºè¨­å®š -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">â­ é›£æ˜“åº¦é¸æŠ</label>
                        <select id="difficultySelect" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="all">ã™ã¹ã¦ã®é›£æ˜“åº¦</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">é¸æŠä¸­: <span id="difficultyCount">0</span>å•</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ”€ å•é¡Œã®é †åº</label>
                        <select id="shuffleMode" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="normal">é †ç•ªé€šã‚Š</option>
                            <option value="shuffle">ãƒ©ãƒ³ãƒ€ãƒ </option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">â±ï¸ åˆ¶é™æ™‚é–“ï¼ˆåˆ†ï¼‰</label>
                        <select id="timeLimit" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="0">åˆ¶é™ãªã—</option>
                            <option value="5">5åˆ†</option>
                            <option value="10">10åˆ†</option>
                            <option value="15">15åˆ†</option>
                            <option value="30">30åˆ†</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“Š å•é¡Œæ•°</label>
                        <select id="questionLimit" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="all">ã™ã¹ã¦</option>
                            <option value="5">5å•</option>
                            <option value="10">10å•</option>
                            <option value="20">20å•</option>
                            <option value="50">50å•</option>
                        </select>
                    </div>
                </div>
                
                <div class="mt-8 text-center">
                    <button onclick="startQuiz()" class="canva-button text-white px-12 py-5 rounded-2xl font-bold text-xl shadow-2xl transform hover:scale-105">
                        ğŸš€ ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹ã™ã‚‹
                    </button>
                </div>
            </div>
        </div>



        <!-- ã‚¯ã‚¤ã‚ºç”»é¢ -->
        <div id="quizContainer" class="hidden">
            <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã¨ã‚¿ã‚¤ãƒãƒ¼ -->
            <div class="canva-card rounded-3xl p-6 mb-6 fade-in">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium text-gray-600">é€²æ—</span>
                    <div class="flex items-center space-x-4">
                        <span id="progressText" class="text-sm font-medium text-gray-600" aria-live="polite">1 / 10</span>
                        <div id="timerDisplay" class="hidden flex items-center text-sm font-medium text-orange-600">
                            <span class="mr-1" aria-hidden="true">â±ï¸</span>
                            <span id="timeRemaining" aria-live="polite" aria-label="æ®‹ã‚Šæ™‚é–“">10:00</span>
                        </div>
                    </div>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="10" aria-label="ã‚¯ã‚¤ã‚ºé€²æ—">
                    <div id="progressBar" class="progress-bar h-3 rounded-full" style="width: 10%"></div>
                </div>
            </div>

            <!-- å•é¡Œã‚«ãƒ¼ãƒ‰ -->
            <div class="quiz-card rounded-2xl p-8 text-white mb-6 slide-up">
                <div class="text-center">
                    <div id="questionNumber" class="text-lg font-medium mb-4 opacity-90">å•é¡Œ 1</div>
                    <h2 id="questionText" class="text-2xl font-bold mb-6 leading-relaxed">å•é¡Œæ–‡ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</h2>
                    <div class="flex justify-center space-x-3 mb-4">
                        <div id="questionCategory" class="inline-block bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm font-medium">
                            ä¸€èˆ¬çŸ¥è­˜
                        </div>
                        <div id="questionDifficulty" class="inline-block bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm font-medium">
                            åˆç´š
                        </div>
                        <div id="questionType" class="inline-block bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm font-medium">
                            æŠä¸€é¸æŠ
                        </div>
                    </div>
                </div>
            </div>

            <!-- åºƒå‘Šã‚¹ãƒšãƒ¼ã‚¹4ï¼ˆå•é¡Œé–“ã«è¡¨ç¤ºã€ç„¡æ–™ãƒ—ãƒ©ãƒ³ã®ã¿ï¼‰ -->
            <div id="adSpace4" class="ad-container mb-6">
                <div class="ad-label">åºƒå‘Š</div>
                <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-4 rounded-lg">
                    <h3 class="font-bold mb-2">ğŸ¯ é›†ä¸­åŠ›UPï¼</h3>
                    <p class="text-sm">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã§åºƒå‘Šãªã—ã®å¿«é©å­¦ç¿’ç’°å¢ƒã‚’ä½“é¨“</p>
                </div>
            </div>

            <!-- é¸æŠè‚¢ -->
            <div id="optionsContainer" class="space-y-4 mb-8">
                <!-- é¸æŠè‚¢ãŒã“ã“ã«å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
            </div>

            <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
            <div class="flex flex-col sm:flex-row justify-between items-center space-y-3 sm:space-y-0">
                <div class="flex space-x-3 w-full sm:w-auto">
                    <button onclick="showHome()" class="flex-1 sm:flex-none bg-green-500 hover:bg-green-600 text-white px-4 sm:px-6 py-3 sm:py-4 rounded-xl font-semibold transition-all shadow-lg text-sm sm:text-base">
                        ğŸ  ãƒ›ãƒ¼ãƒ 
                    </button>
                    <button id="prevButton" onclick="previousQuestion()" 
                            class="flex-1 sm:flex-none bg-gray-400 hover:bg-gray-500 text-white px-4 sm:px-8 py-3 sm:py-4 rounded-xl font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg text-sm sm:text-base">
                        â† å‰ã®å•é¡Œ
                    </button>
                </div>
                <button id="nextButton" onclick="nextQuestion()" 
                        class="w-full sm:w-auto canva-button text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg text-sm sm:text-base">
                    æ¬¡ã®å•é¡Œ â†’
                </button>
            </div>
        </div>

        <!-- çµæœç”»é¢ -->
        <div id="resultContainer" class="hidden">
            <div class="canva-card rounded-3xl p-8 text-center mb-6 fade-in">
                <div class="text-6xl mb-4">ğŸ‰</div>
                <h2 class="text-3xl font-bold text-gray-800 mb-4">ã‚¯ã‚¤ã‚ºå®Œäº†ï¼</h2>
                <div class="text-6xl font-bold text-purple-600 mb-2 bounce-in" id="finalScore">8/10</div>
                <p class="text-gray-600 mb-6">ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="bg-green-50 p-4 rounded-lg">
                        <div class="text-2xl font-bold text-green-600" id="correctCount">8</div>
                        <div class="text-sm text-green-600">æ­£è§£</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg">
                        <div class="text-2xl font-bold text-red-600" id="incorrectCount">2</div>
                        <div class="text-sm text-red-600">ä¸æ­£è§£</div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="text-2xl font-bold text-blue-600" id="accuracyRate">80%</div>
                        <div class="text-sm text-blue-600">æ­£ç­”ç‡</div>
                    </div>
                </div>
                <!-- ç§°å·è¡¨ç¤º -->
                <div id="achievementSection" class="hidden mb-8">
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-3xl p-6 text-center text-white shadow-2xl bounce-in">
                        <div class="text-4xl mb-3">ğŸ†</div>
                        <h3 class="text-2xl font-bold mb-2">ç§°å·ç²å¾—ï¼</h3>
                        <div id="achievementTitle" class="text-3xl font-bold mb-2">ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°é“å ´ åˆç´šãƒã‚¹ã‚¿ãƒ¼</div>
                        <p id="achievementDescription" class="text-lg opacity-90">åˆç´šãƒ¬ãƒ™ãƒ«ã®å•é¡Œã‚’å…¨å•æ­£è§£ã—ã¾ã—ãŸï¼</p>
                    </div>
                </div>
                
                <!-- åºƒå‘Šã‚¹ãƒšãƒ¼ã‚¹5ï¼ˆçµæœç”»é¢ã€ç„¡æ–™ãƒ—ãƒ©ãƒ³ã®ã¿ï¼‰ -->
                <div id="adSpace5" class="ad-container mb-6">
                    <div class="ad-label">ãŠã™ã™ã‚</div>
                    <div class="bg-gradient-to-r from-pink-500 to-rose-600 text-white p-4 rounded-lg">
                        <h3 class="font-bold mb-2">ğŸ† ã•ã‚‰ãªã‚‹é«˜ã¿ã¸</h3>
                        <p class="text-sm">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã§ä¸Šç´šå•é¡Œã«æŒ‘æˆ¦ã—ã€çœŸã®ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚’ç›®æŒ‡ãã†</p>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                    <button onclick="showHome()" 
                            class="bg-green-500 hover:bg-green-600 text-white px-6 sm:px-8 py-3 sm:py-4 rounded-2xl font-semibold shadow-lg text-sm sm:text-base">
                        ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
                    </button>
                    <button onclick="showDetailedResults()" 
                            class="canva-button text-white px-6 sm:px-8 py-3 sm:py-4 rounded-2xl font-semibold shadow-lg text-sm sm:text-base">
                        ğŸ“Š è©³ç´°çµæœã‚’è¦‹ã‚‹
                    </button>
                    <button onclick="restartQuiz()" 
                            class="canva-button text-white px-6 sm:px-8 py-3 sm:py-4 rounded-2xl font-semibold shadow-lg text-sm sm:text-base">
                        ğŸ”„ ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦
                    </button>
                </div>
            </div>
            
            <!-- è©³ç´°çµæœ -->
            <div id="detailedResults" class="hidden canva-card rounded-3xl p-6 fade-in">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">ğŸ“Š å•é¡Œåˆ¥è©³ç´°çµæœ</h3>
                <div id="detailedResultsList" class="space-y-4">
                    <!-- è©³ç´°çµæœãŒã“ã“ã«å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                </div>
                <div class="text-center mt-6">
                    <button onclick="hideDetailedResults()" 
                            class="bg-gray-400 hover:bg-gray-500 text-white px-8 py-4 rounded-2xl font-semibold transition-all shadow-lg">
                        â† æˆ»ã‚‹
                    </button>
                </div>
            </div>
        </div>
        
        <!-- SEOç”¨ãƒ•ãƒƒã‚¿ãƒ¼ -->
        <footer class="mt-16 bg-gray-800 text-white py-8">
            <div class="container mx-auto px-4 max-w-4xl">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div>
                        <h4 class="text-lg font-bold mb-4">ã‚†ã‚‹ãƒãƒ¼ã‚±é“å ´ã«ã¤ã„ã¦</h4>
                        <p class="text-gray-300 text-sm">
                            ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã‚¹ã‚­ãƒ«ã‚’æ¥½ã—ãå­¦ã¹ã‚‹ã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒªã§ã™ã€‚SEOã€åºƒå‘Šé‹ç”¨ã€AIæ´»ç”¨ãªã©å®Ÿè·µçš„ãªå•é¡Œã§çŸ¥è­˜ã‚’æ·±ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
                        </p>
                    </div>
                    <div>
                        <h4 class="text-lg font-bold mb-4">å­¦ç¿’ã‚«ãƒ†ã‚´ãƒª</h4>
                        <ul class="text-gray-300 text-sm space-y-2">
                            <li><a href="#" class="hover:text-white">SEOï¼ˆæ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³æœ€é©åŒ–ï¼‰</a></li>
                            <li><a href="#" class="hover:text-white">ãƒ‡ã‚¸ã‚¿ãƒ«åºƒå‘Šé‹ç”¨</a></li>
                            <li><a href="#" class="hover:text-white">AIãƒ»ChatGPTæ´»ç”¨</a></li>
                            <li><a href="#" class="hover:text-white">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°</a></li>
                            <li><a href="#" class="hover:text-white">ECã‚µã‚¤ãƒˆé‹å–¶</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="text-lg font-bold mb-4">ãƒ—ãƒ©ãƒ³</h4>
                        <ul class="text-gray-300 text-sm space-y-2">
                            <li>ç„¡æ–™ãƒ—ãƒ©ãƒ³ - åˆç´šå•é¡Œã«ã‚¢ã‚¯ã‚»ã‚¹</li>
                            <li>ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ - å…¨å•é¡Œï¼‹è©³ç´°è§£èª¬</li>
                        </ul>
                        <div class="mt-4">
                            <p class="text-xs text-gray-400">
                                Â© 2024 ã‚†ã‚‹ãƒãƒ¼ã‚±é“å ´. All rights reserved.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        let questions = [];
        let originalQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let selectedAnswers = new Set();
        let timerInterval = null;
        let timeRemaining = 0;
        let quizStartTime = null;
        let quizHistory = JSON.parse(localStorage.getItem('quizHistory') || '[]');
        let scoreChart = null;
        let categoryChart = null;
        let selectedCategory = 'all';

        // æ–‡å­—ã®æ­£è¦åŒ–é–¢æ•°ï¼ˆâ—‹Ã—ã®æ–‡å­—åŒ–ã‘ã‚’é˜²ãï¼‰
        function normalizeText(text) {
            return text.trim()
                .replace(/â—‹/g, 'â—‹')  // å…¨è§’â—‹ã«çµ±ä¸€
                .replace(/Ã—/g, 'Ã—')  // å…¨è§’Ã—ã«çµ±ä¸€
                .replace(/â—¯/g, 'â—‹')  // â—¯ã‚’â—‹ã«å¤‰æ›
                .replace(/âœ•/g, 'Ã—')  // âœ•ã‚’Ã—ã«å¤‰æ›
                .replace(/\s+/g, ' '); // è¤‡æ•°ã®ç©ºç™½ã‚’1ã¤ã«
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
        let currentUser = null;
        
        // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®æ°¸ç¶šåŒ–
        function saveUserSession(user) {
            localStorage.setItem('currentUser', JSON.stringify(user));
        }
        
        function loadUserSession() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    return JSON.parse(savedUser);
                } catch (error) {
                    console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å¾©å…ƒã«å¤±æ•—:', error);
                    localStorage.removeItem('currentUser');
                }
            }
            return null;
        }
        
        function clearUserSession() {
            localStorage.removeItem('currentUser');
        }
        
        // ãƒ‡ãƒ¢ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿
        const demoUsers = {
            'demo@free.com': { name: 'ãƒ•ãƒªãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼', plan: 'free', password: 'password123' },
            'demo@premium.com': { name: 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼', plan: 'premium', password: 'password123' },
            'admin@demo.com': { name: 'ç®¡ç†è€…', plan: 'admin', password: 'admin123' }
        };

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆç®¡ç†
        function getUserStats() {
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const loginHistory = JSON.parse(localStorage.getItem('loginHistory') || '[]');
            
            // ä»Šæ—¥ã®ãƒ­ã‚°ã‚¤ãƒ³æ•°
            const today = new Date().toDateString();
            const todayLogins = loginHistory.filter(login => 
                new Date(login.timestamp).toDateString() === today
            ).length;
            
            // ä»Šé€±ã®ãƒ­ã‚°ã‚¤ãƒ³æ•°
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const weeklyLogins = loginHistory.filter(login => 
                new Date(login.timestamp) >= weekAgo
            ).length;
            
            // ãƒ—ãƒ©ãƒ³åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
            const planStats = {
                free: registeredUsers.filter(user => user.plan === 'free').length,
                premium: registeredUsers.filter(user => user.plan === 'premium').length,
                admin: registeredUsers.filter(user => user.plan === 'admin').length
            };
            
            return {
                totalUsers: registeredUsers.length + Object.keys(demoUsers).length,
                registeredUsers: registeredUsers.length,
                demoUsers: Object.keys(demoUsers).length,
                todayLogins,
                weeklyLogins,
                planStats
            };
        }

        function trackLogin(email, plan) {
            const loginHistory = JSON.parse(localStorage.getItem('loginHistory') || '[]');
            loginHistory.push({
                email,
                plan,
                timestamp: new Date().toISOString()
            });
            
            // æœ€æ–°100ä»¶ã®ã¿ä¿æŒ
            if (loginHistory.length > 100) {
                loginHistory.splice(0, loginHistory.length - 100);
            }
            
            localStorage.setItem('loginHistory', JSON.stringify(loginHistory));
        }

        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
        const sampleQuestions = [
            {
                question: "SEOã¨ã¯ä½•ã®ç•¥ç§°ã§ã™ã‹ï¼Ÿ",
                type: "single",
                options: ["Search Engine Optimization", "Social Engine Optimization", "System Engine Operation", "Site Engine Organization"],
                correct: ["Search Engine Optimization"],
                category: "SEO",
                difficulty: "åˆç´š",
                explanation: "SEOã¯ã€ŒSearch Engine Optimizationï¼ˆæ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³æœ€é©åŒ–ï¼‰ã€ã®ç•¥ç§°ã§ã™ã€‚æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã§ã®è¡¨ç¤ºé †ä½ã‚’å‘ä¸Šã•ã›ã‚‹æ–½ç­–ã®ã“ã¨ã‚’æŒ‡ã—ã¾ã™ã€‚"
            },
            {
                question: "HTMLã®æ­£å¼åç§°ã¯ä½•ã§ã™ã‹ï¼Ÿ",
                type: "single",
                options: ["HyperText Markup Language", "High Tech Modern Language", "Home Tool Markup Language", "Hyper Transfer Markup Language"],
                correct: ["HyperText Markup Language"],
                category: "HTML",
                difficulty: "åˆç´š",
                explanation: "HTMLã¯ã€ŒHyperText Markup Languageã€ã®ç•¥ç§°ã§ã™ã€‚Webãƒšãƒ¼ã‚¸ã®æ§‹é€ ã‚’è¨˜è¿°ã™ã‚‹ãŸã‚ã®ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èªã§ã™ã€‚"
            },
            {
                question: "Googleåºƒå‘Šã®èª²é‡‘æ–¹å¼ã¨ã—ã¦æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰",
                type: "multiple",
                options: ["CPCï¼ˆã‚¯ãƒªãƒƒã‚¯èª²é‡‘ï¼‰", "CPMï¼ˆã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³èª²é‡‘ï¼‰", "CPAï¼ˆæˆæœèª²é‡‘ï¼‰", "CPLï¼ˆãƒªãƒ¼ãƒ‰èª²é‡‘ï¼‰"],
                correct: ["CPCï¼ˆã‚¯ãƒªãƒƒã‚¯èª²é‡‘ï¼‰", "CPMï¼ˆã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³èª²é‡‘ï¼‰"],
                category: "åºƒå‘Š",
                difficulty: "ä¸­ç´š",
                explanation: "Googleåºƒå‘Šã§ã¯ä¸»ã«CPCï¼ˆã‚¯ãƒªãƒƒã‚¯èª²é‡‘ï¼‰ã¨CPMï¼ˆã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³èª²é‡‘ï¼‰ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚CPAã‚„CPLã¯ä»–ã®åºƒå‘Šãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚ˆãä½¿ã‚ã‚Œã‚‹èª²é‡‘æ–¹å¼ã§ã™ã€‚"
            },
            {
                question: "CSSã§ãƒ†ã‚­ã‚¹ãƒˆã®è‰²ã‚’èµ¤ã«ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ä½•ã§ã™ã‹ï¼Ÿ",
                type: "single",
                options: ["color: red;", "text-color: red;", "font-color: red;", "background: red;"],
                correct: ["color: red;"],
                category: "CSS",
                difficulty: "åˆç´š",
                explanation: "CSSã§ãƒ†ã‚­ã‚¹ãƒˆã®è‰²ã‚’æŒ‡å®šã™ã‚‹ã«ã¯ã€Œcolorã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã€Œcolor: red;ã€ã§ãƒ†ã‚­ã‚¹ãƒˆãŒèµ¤è‰²ã«ãªã‚Šã¾ã™ã€‚"
            },
            {
                question: "ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°è©æ¬ºã¨ã¯å½ã®Webã‚µã‚¤ãƒˆã§å€‹äººæƒ…å ±ã‚’ç›—ã‚€æ‰‹æ³•ã§ã‚ã‚‹",
                type: "truefalse",
                options: ["â—‹", "Ã—"],
                correct: ["â—‹"],
                category: "ãƒªãƒ†ãƒ©ã‚·ãƒ¼",
                difficulty: "åˆç´š",
                explanation: "ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°è©æ¬ºã¯ã€æ­£è¦ã®Webã‚µã‚¤ãƒˆã‚’è£…ã£ãŸå½ã‚µã‚¤ãƒˆã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å€‹äººæƒ…å ±ï¼ˆIDã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æƒ…å ±ãªã©ï¼‰ã‚’ç›—ã‚€è©æ¬ºæ‰‹æ³•ã§ã™ã€‚"
            },
            {
                question: "WordPressã§è¨˜äº‹ã‚’æŠ•ç¨¿ã™ã‚‹éš›ã®åŸºæœ¬çš„ãªæŠ•ç¨¿ã‚¿ã‚¤ãƒ—ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ",
                type: "single",
                options: ["Post", "Page", "Media", "Comment"],
                correct: ["Post"],
                category: "WordPress",
                difficulty: "åˆç´š",
                explanation: "WordPressã§ã¯ã€ŒPostï¼ˆæŠ•ç¨¿ï¼‰ã€ãŒåŸºæœ¬çš„ãªè¨˜äº‹æŠ•ç¨¿ã‚¿ã‚¤ãƒ—ã§ã™ã€‚Pageã¯å›ºå®šãƒšãƒ¼ã‚¸ã€Mediaã¯ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ã€Commentã¯ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ã§ã™ã€‚"
            },
            {
                question: "ãƒ¡ãƒ¼ãƒ«ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã§é‡è¦ãªæŒ‡æ¨™ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰",
                type: "multiple",
                options: ["é–‹å°ç‡", "ã‚¯ãƒªãƒƒã‚¯ç‡", "é…ä¿¡æ•°", "è§£é™¤ç‡"],
                correct: ["é–‹å°ç‡", "ã‚¯ãƒªãƒƒã‚¯ç‡", "è§£é™¤ç‡"],
                category: "ãƒ¡ãƒ¼ãƒ«",
                difficulty: "ä¸­ç´š",
                explanation: "ãƒ¡ãƒ¼ãƒ«ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã§ã¯é–‹å°ç‡ï¼ˆãƒ¡ãƒ¼ãƒ«ãŒé–‹ã‹ã‚ŒãŸå‰²åˆï¼‰ã€ã‚¯ãƒªãƒƒã‚¯ç‡ï¼ˆãƒªãƒ³ã‚¯ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸå‰²åˆï¼‰ã€è§£é™¤ç‡ï¼ˆé…ä¿¡åœæ­¢ã•ã‚ŒãŸå‰²åˆï¼‰ãŒé‡è¦ãªæŒ‡æ¨™ã§ã™ã€‚é…ä¿¡æ•°ã¯æŒ‡æ¨™ã¨ã„ã†ã‚ˆã‚Šå®Ÿç¸¾å€¤ã§ã™ã€‚"
            },
            {
                question: "ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã®ä¸»ãªç›®çš„ã¯ä½•ã§ã™ã‹ï¼Ÿ",
                type: "single",
                options: ["ä¾¡å€¤ã®ã‚ã‚‹æƒ…å ±æä¾›ã§é¡§å®¢ã¨ã®é–¢ä¿‚æ§‹ç¯‰", "å•†å“ã®ç›´æ¥è²©å£²", "ç«¶åˆä»–ç¤¾ã®åˆ†æ", "SEOå¯¾ç­–ã®ã¿"],
                correct: ["ä¾¡å€¤ã®ã‚ã‚‹æƒ…å ±æä¾›ã§é¡§å®¢ã¨ã®é–¢ä¿‚æ§‹ç¯‰"],
                category: "ã‚³ãƒ³ãƒ†ãƒ³ãƒ„",
                difficulty: "ä¸­ç´š",
                explanation: "ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã¯ã€ä¾¡å€¤ã®ã‚ã‚‹æƒ…å ±ã‚’ç¶™ç¶šçš„ã«æä¾›ã™ã‚‹ã“ã¨ã§é¡§å®¢ã¨ã®ä¿¡é ¼é–¢ä¿‚ã‚’æ§‹ç¯‰ã—ã€æœ€çµ‚çš„ã«ãƒ“ã‚¸ãƒã‚¹æˆæœã«ã¤ãªã’ã‚‹æ‰‹æ³•ã§ã™ã€‚"
            },
            {
                question: "ECã‚µã‚¤ãƒˆã§ã®ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç‡ã‚’å‘ä¸Šã•ã›ã‚‹æ–½ç­–ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰",
                type: "multiple",
                options: ["å•†å“ç”»åƒã®æœ€é©åŒ–", "æ±ºæ¸ˆæ–¹æ³•ã®å¤šæ§˜åŒ–", "ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã®å……å®Ÿ", "ã‚µã‚¤ãƒˆã®è¡¨ç¤ºé€Ÿåº¦å‘ä¸Š"],
                correct: ["å•†å“ç”»åƒã®æœ€é©åŒ–", "æ±ºæ¸ˆæ–¹æ³•ã®å¤šæ§˜åŒ–", "ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã®å……å®Ÿ", "ã‚µã‚¤ãƒˆã®è¡¨ç¤ºé€Ÿåº¦å‘ä¸Š"],
                category: "EC",
                difficulty: "ä¸Šç´š",
                explanation: "ECã‚µã‚¤ãƒˆã®ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç‡å‘ä¸Šã«ã¯ã€å•†å“ç”»åƒã®æœ€é©åŒ–ã€æ±ºæ¸ˆæ–¹æ³•ã®å¤šæ§˜åŒ–ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã®å……å®Ÿã€ã‚µã‚¤ãƒˆã®è¡¨ç¤ºé€Ÿåº¦å‘ä¸Šãªã©ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’å‘ä¸Šã•ã›ã‚‹å…¨ã¦ã®æ–½ç­–ãŒæœ‰åŠ¹ã§ã™ã€‚"
            },
            {
                question: "ChatGPTãªã©ã®ç”ŸæˆAIã®ç‰¹å¾´ã¨ã—ã¦æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ",
                type: "single",
                options: ["å¸¸ã«æ­£ç¢ºãªæƒ…å ±ã‚’æä¾›ã™ã‚‹", "å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦å¿œç­”ã‚’ç”Ÿæˆã™ã‚‹", "ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹", "æ„Ÿæƒ…ã‚’æŒã£ã¦åˆ¤æ–­ã™ã‚‹"],
                correct: ["å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦å¿œç­”ã‚’ç”Ÿæˆã™ã‚‹"],
                category: "AI",
                difficulty: "ä¸­ç´š",
                explanation: "ç”ŸæˆAIã¯å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦å¿œç­”ã‚’ç”Ÿæˆã—ã¾ã™ã€‚å¸¸ã«æ­£ç¢ºã¨ã¯é™ã‚‰ãšã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚„æ„Ÿæƒ…ã‚’æŒã£ãŸåˆ¤æ–­ã¯ã§ãã¾ã›ã‚“ã€‚"
            }
        ];

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ
        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        function createParticles(element) {
            const rect = element.getBoundingClientRect();
            for (let i = 0; i < 10; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = (rect.left + rect.width / 2) + 'px';
                particle.style.top = (rect.top + rect.height / 2) + 'px';
                particle.style.animationDelay = (i * 0.1) + 's';
                document.body.appendChild(particle);
                
                setTimeout(() => {
                    particle.remove();
                }, 2000);
            }
        }

        // åºƒå‘Šè¡¨ç¤ºåˆ¶å¾¡
        function toggleAds() {
            const adElements = document.querySelectorAll('[id^="adSpace"], [id^="homeAdSpace"]');
            adElements.forEach(ad => {
                if (currentUser && currentUser.plan === 'premium') {
                    ad.style.display = 'none';
                } else {
                    ad.style.display = 'block';
                }
            });
        }

        // ãƒ‡ãƒ¼ã‚¿åˆ†ææ©Ÿèƒ½
        function saveQuizResult(result) {
            const quizData = {
                date: new Date().toISOString(),
                score: result.correctCount,
                total: result.totalQuestions,
                accuracy: result.accuracy,
                category: selectedCategory,
                difficulty: document.getElementById('difficultySelect').value,
                timeSpent: result.timeSpent,
                questions: result.questions
            };
            
            quizHistory.push(quizData);
            localStorage.setItem('quizHistory', JSON.stringify(quizHistory));
            
            // Phase 2: ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†
            const xpGained = calculateXP(result.correctCount, result.totalQuestions, quizData.difficulty);
            const leveledUp = updateUserLevel(xpGained);
            const newBadges = checkAndAwardBadges(quizData);
            updateDailyGoals(quizData, xpGained);
            
            // XPç²å¾—é€šçŸ¥
            if (xpGained > 0) {
                showXPNotification(xpGained, leveledUp);
            }
        }
        
        function showXPNotification(xp, leveledUp) {
            if (leveledUp) return; // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—é€šçŸ¥ãŒå„ªå…ˆ
            
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-gradient-to-r from-green-400 to-blue-500 text-white p-4 rounded-xl shadow-lg z-50 fade-in';
            notification.innerHTML = `
                <div class="flex items-center">
                    <div class="text-2xl mr-3">â­</div>
                    <div>
                        <div class="font-bold">+${xp} XP ç²å¾—ï¼</div>
                        <div class="text-sm opacity-90">ã‚ˆãã§ãã¾ã—ãŸï¼</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function showAnalytics() {
            document.getElementById('setupPanel').classList.add('hidden');
            document.getElementById('analyticsContainer').classList.remove('hidden');
            
            updateAnalyticsDashboard();
        }

        function hideAnalytics() {
            document.getElementById('analyticsContainer').classList.add('hidden');
            document.getElementById('setupPanel').classList.remove('hidden');
        }

        function updateAnalyticsDashboard() {
            if (quizHistory.length === 0) {
                document.getElementById('totalQuizzes').textContent = '0';
                document.getElementById('averageScore').textContent = '0%';
                document.getElementById('totalTime').textContent = '0åˆ†';
                document.getElementById('streak').textContent = '0æ—¥';
                return;
            }

            // åŸºæœ¬çµ±è¨ˆ
            const totalQuizzes = quizHistory.length;
            const averageScore = Math.round(
                quizHistory.reduce((sum, quiz) => sum + quiz.accuracy, 0) / totalQuizzes
            );
            const totalTime = Math.round(
                quizHistory.reduce((sum, quiz) => sum + (quiz.timeSpent || 0), 0) / 60
            );
            
            // é€£ç¶šå­¦ç¿’æ—¥æ•°è¨ˆç®—
            const streak = calculateStreak();

            document.getElementById('totalQuizzes').textContent = totalQuizzes;
            document.getElementById('averageScore').textContent = averageScore + '%';
            document.getElementById('totalTime').textContent = totalTime + 'åˆ†';
            document.getElementById('streak').textContent = streak + 'æ—¥';

            // ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
            updateScoreChart();
            updateCategoryChart();
            updateWeaknessAnalysis();
        }

        function calculateStreak() {
            if (quizHistory.length === 0) return 0;
            
            const today = new Date();
            const dates = quizHistory.map(quiz => new Date(quiz.date).toDateString());
            const uniqueDates = [...new Set(dates)].sort((a, b) => new Date(b) - new Date(a));
            
            let streak = 0;
            let currentDate = today;
            
            for (const dateStr of uniqueDates) {
                const date = new Date(dateStr);
                const diffDays = Math.floor((currentDate - date) / (1000 * 60 * 60 * 24));
                
                if (diffDays === streak) {
                    streak++;
                    currentDate = date;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function updateScoreChart() {
            const ctx = document.getElementById('scoreChart').getContext('2d');
            
            if (scoreChart) {
                scoreChart.destroy();
            }
            
            const last10Quizzes = quizHistory.slice(-10);
            const labels = last10Quizzes.map((_, index) => `${index + 1}å›ç›®`);
            const data = last10Quizzes.map(quiz => quiz.accuracy);
            
            scoreChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'æ­£ç­”ç‡ (%)',
                        data: data,
                        borderColor: '#00c4cc',
                        backgroundColor: 'rgba(0, 196, 204, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function updateCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            
            if (categoryChart) {
                categoryChart.destroy();
            }
            
            const categoryStats = {};
            quizHistory.forEach(quiz => {
                const category = quiz.category || 'ãã®ä»–';
                if (!categoryStats[category]) {
                    categoryStats[category] = { total: 0, correct: 0 };
                }
                categoryStats[category].total += quiz.total;
                categoryStats[category].correct += quiz.score;
            });
            
            const labels = Object.keys(categoryStats);
            const data = labels.map(category => 
                Math.round((categoryStats[category].correct / categoryStats[category].total) * 100)
            );
            
            categoryChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'æ­£ç­”ç‡ (%)',
                        data: data,
                        backgroundColor: [
                            '#00c4cc',
                            '#7b68ee',
                            '#ff6b9d',
                            '#00d4aa',
                            '#ffa500'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function updateWeaknessAnalysis() {
            const container = document.getElementById('weaknessAnalysis');
            
            if (quizHistory.length === 0) {
                container.innerHTML = '<p class="text-gray-500">ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚ã‚‚ã£ã¨ã‚¯ã‚¤ã‚ºã«æŒ‘æˆ¦ã—ã¦ãã ã•ã„ï¼</p>';
                return;
            }
            
            // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®å¼±ç‚¹åˆ†æ
            const categoryStats = {};
            quizHistory.forEach(quiz => {
                const category = quiz.category || 'ãã®ä»–';
                if (!categoryStats[category]) {
                    categoryStats[category] = { total: 0, correct: 0 };
                }
                categoryStats[category].total += quiz.total;
                categoryStats[category].correct += quiz.score;
            });
            
            const weakCategories = Object.entries(categoryStats)
                .map(([category, stats]) => ({
                    category,
                    accuracy: (stats.correct / stats.total) * 100,
                    total: stats.total
                }))
                .filter(item => item.accuracy < 70)
                .sort((a, b) => a.accuracy - b.accuracy);
            
            let html = '';
            if (weakCategories.length === 0) {
                html = '<div class="text-green-600">ğŸ‰ ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒªã§è‰¯å¥½ãªæˆç¸¾ã§ã™ï¼</div>';
            } else {
                html = '<div class="space-y-3">';
                weakCategories.forEach(item => {
                    html += `
                        <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg border-l-4 border-red-400">
                            <div>
                                <span class="font-medium text-red-800">${item.category}</span>
                                <span class="text-sm text-red-600 ml-2">(${item.total}å•ä¸­)</span>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold text-red-600">${Math.round(item.accuracy)}%</div>
                                <div class="text-xs text-red-500">è¦å¾©ç¿’</div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        // ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½
        function showLogin() {
            document.getElementById('registerContainer').classList.add('hidden');
            document.getElementById('loginContainer').classList.remove('hidden');
        }

        function showRegister() {
            document.getElementById('loginContainer').classList.add('hidden');
            document.getElementById('registerContainer').classList.remove('hidden');
        }

        function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                alert('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // ãƒ‡ãƒ¢ç”¨èªè¨¼
            if (demoUsers[email] && demoUsers[email].password === password) {
                currentUser = {
                    email: email,
                    name: demoUsers[email].name,
                    plan: demoUsers[email].plan,
                    loginMethod: 'email'
                };
                
                // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ä¿å­˜
                saveUserSession(currentUser);
                
                // ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´ã‚’è¨˜éŒ²
                trackLogin(email, currentUser.plan);
                
                showMainApp();
                
                // Google Analytics ã‚¤ãƒ™ãƒ³ãƒˆ
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'login', {
                        method: 'email',
                        user_plan: currentUser.plan
                    });
                }
            } else {
                alert('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™');
            }
        }
        
        // Googleãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½
        function googleLogin() {
            // ãƒ‡ãƒ¢ç‰ˆã§ã¯ç°¡æ˜“çš„ãªGoogleãƒ­ã‚°ã‚¤ãƒ³ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            if (typeof google !== 'undefined' && google.accounts) {
                // å®Ÿéš›ã®Google Sign-Inå®Ÿè£…
                google.accounts.id.initialize({
                    client_id: 'YOUR_GOOGLE_CLIENT_ID', // å®Ÿéš›ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã«ç½®ãæ›ãˆ
                    callback: handleGoogleSignIn
                });
                
                google.accounts.id.prompt();
            } else {
                // ãƒ‡ãƒ¢ç‰ˆã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                const mockGoogleUser = {
                    email: 'demo.google@gmail.com',
                    name: 'Google ãƒ¦ãƒ¼ã‚¶ãƒ¼',
                    picture: 'https://via.placeholder.com/40',
                    plan: 'free'
                };
                
                currentUser = {
                    ...mockGoogleUser,
                    loginMethod: 'google'
                };
                
                // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ä¿å­˜
                saveUserSession(currentUser);
                
                // ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´ã‚’è¨˜éŒ²
                trackLogin(mockGoogleUser.email, mockGoogleUser.plan);
                
                alert('Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸï¼\nï¼ˆãƒ‡ãƒ¢ç‰ˆã®ãŸã‚ã€å®Ÿéš›ã®Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ä½¿ç”¨ã•ã‚Œã¾ã›ã‚“ï¼‰');
                showMainApp();
                
                // Google Analytics ã‚¤ãƒ™ãƒ³ãƒˆ
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'login', {
                        method: 'google',
                        user_plan: currentUser.plan
                    });
                }
            }
        }
        
        function handleGoogleSignIn(response) {
            // JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯é©åˆ‡ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ï¼‰
            const payload = JSON.parse(atob(response.credential.split('.')[1]));
            
            currentUser = {
                email: payload.email,
                name: payload.name,
                picture: payload.picture,
                plan: 'free', // æ–°è¦Googleãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç„¡æ–™ãƒ—ãƒ©ãƒ³ã‹ã‚‰é–‹å§‹
                loginMethod: 'google'
            };
            
            // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ä¿å­˜
            saveUserSession(currentUser);
            
            // ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´ã‚’è¨˜éŒ²
            trackLogin(payload.email, 'free');
            
            showMainApp();
            
            // Google Analytics ã‚¤ãƒ™ãƒ³ãƒˆ
            if (typeof gtag !== 'undefined') {
                gtag('event', 'login', {
                    method: 'google',
                    user_plan: 'free'
                });
            }
        }

        function register() {
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            
            if (!name || !email || !password) {
                alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // ç°¡å˜ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (!email.includes('@')) {
                alert('æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (password.length < 6) {
                alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆï¼ˆãƒ‡ãƒ¢ç‰ˆï¼‰
            currentUser = {
                email: email,
                name: name,
                plan: 'free',
                loginMethod: 'email'
            };
            
            // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ä¿å­˜
            saveUserSession(currentUser);
            
            // ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            registeredUsers.push(currentUser);
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
            
            // ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´ã‚’è¨˜éŒ²
            trackLogin(email, 'free');
            
            alert('ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
            showMainApp();
            
            // Google Analytics ã‚¤ãƒ™ãƒ³ãƒˆ
            if (typeof gtag !== 'undefined') {
                gtag('event', 'sign_up', {
                    method: 'email'
                });
            }
        }

        function loginAsGuest() {
            currentUser = {
                email: 'guest@example.com',
                name: 'ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',
                plan: 'free',
                loginMethod: 'guest'
            };
            
            // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ä¿å­˜
            saveUserSession(currentUser);
            
            // ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´ã‚’è¨˜éŒ²
            trackLogin('guest@example.com', 'free');
            
            showMainApp();
            
            // Google Analytics ã‚¤ãƒ™ãƒ³ãƒˆ
            if (typeof gtag !== 'undefined') {
                gtag('event', 'login', {
                    method: 'guest'
                });
            }
        }

        function logout() {
            currentUser = null;
            
            // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
            clearUserSession();
            
            document.getElementById('mainHeader').classList.add('hidden');
            document.getElementById('homeContainer').classList.add('hidden');
            document.getElementById('setupPanel').classList.add('hidden');
            document.getElementById('quizContainer').classList.add('hidden');
            document.getElementById('resultContainer').classList.add('hidden');
            document.getElementById('analyticsContainer').classList.add('hidden');
            document.getElementById('adminContainer').classList.add('hidden');
            document.getElementById('loginContainer').classList.remove('hidden');
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
            
            // Google Analytics ã‚¤ãƒ™ãƒ³ãƒˆ
            if (typeof gtag !== 'undefined') {
                gtag('event', 'logout');
            }
        }

        function showMainApp() {
            document.getElementById('loginContainer').classList.add('hidden');
            document.getElementById('registerContainer').classList.add('hidden');
            document.getElementById('mainHeader').classList.remove('hidden');
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¡¨ç¤º
            const userNameDisplay = document.getElementById('userNameDisplay');
            
            // Googleãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å ´åˆã¯ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚‚è¡¨ç¤º
            if (currentUser.loginMethod === 'google' && currentUser.picture) {
                userNameDisplay.innerHTML = `
                    <div class="flex items-center">
                        <img src="${currentUser.picture}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«" class="w-6 h-6 rounded-full mr-2">
                        <span>${currentUser.name}</span>
                    </div>
                `;
            } else {
                userNameDisplay.textContent = currentUser.name;
            }
            
            const planDisplay = document.getElementById('userPlanDisplay');
            const upgradeButton = document.getElementById('upgradeButton');
            const adminButton = document.getElementById('adminButton');
            const changeImageButton = document.getElementById('changeImageButton');
            
            if (currentUser.plan === 'admin') {
                planDisplay.textContent = 'ç®¡ç†è€…';
                planDisplay.className = 'text-xs sm:text-sm px-2 sm:px-3 py-1 rounded-full bg-gradient-to-r from-red-500 to-orange-500 text-white';
                upgradeButton.classList.add('hidden');
                if (adminButton) adminButton.classList.remove('hidden');
                if (changeImageButton) changeImageButton.classList.remove('hidden');
            } else if (currentUser.plan === 'premium') {
                planDisplay.textContent = 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³';
                planDisplay.className = 'text-xs sm:text-sm px-2 sm:px-3 py-1 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 text-white';
                upgradeButton.classList.add('hidden');
                if (adminButton) adminButton.classList.add('hidden');
                if (changeImageButton) changeImageButton.classList.add('hidden');
            } else {
                planDisplay.textContent = 'ç„¡æ–™ãƒ—ãƒ©ãƒ³';
                planDisplay.className = 'text-xs sm:text-sm px-2 sm:px-3 py-1 rounded-full bg-blue-100 text-blue-600';
                upgradeButton.classList.remove('hidden');
                if (adminButton) adminButton.classList.add('hidden');
                if (changeImageButton) changeImageButton.classList.add('hidden');
            }
            
            // ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã€ãªã‘ã‚Œã°ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
            loadStoredDataOrSample();
            
            // ãƒ›ãƒ¼ãƒ ç”»é¢ã‚’è¡¨ç¤º
            showHome();
            
            // åºƒå‘Šè¡¨ç¤ºåˆ¶å¾¡
            toggleAds();
            
            // ã‚«ã‚¹ã‚¿ãƒ ç”»åƒã®å¾©å…ƒ
            loadCustomHeroImage();
        }

        function loadStoredDataOrSample() {
            const storedQuestions = localStorage.getItem('quizQuestions');
            if (storedQuestions) {
                try {
                    originalQuestions = JSON.parse(storedQuestions);
                    questions = [...originalQuestions];
                    console.log('ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸ:', originalQuestions.length + 'å•');
                    
                    // ãƒ‡ãƒ¼ã‚¿å¾©å…ƒå¾Œã«å…¨ç”»é¢ã‚’æ›´æ–°
                    setTimeout(() => {
                        updateCategoryGrid();
                        updateHomeStats();
                        updateRecentHistory();
                        updateDifficultyOptions(selectedCategory);
                    }, 100);
                } catch (error) {
                    console.error('ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã«å¤±æ•—:', error);
                    loadSampleData();
                }
            } else {
                loadSampleData();
            }
        }

        function showHome() {
            // å…¨ã¦ã®ç”»é¢ã‚’éè¡¨ç¤º
            document.getElementById('setupPanel').classList.add('hidden');
            document.getElementById('quizContainer').classList.add('hidden');
            document.getElementById('resultContainer').classList.add('hidden');
            document.getElementById('analyticsContainer').classList.add('hidden');
            document.getElementById('detailedResults').classList.add('hidden');
            document.getElementById('adminContainer').classList.add('hidden');
            
            // ãƒ›ãƒ¼ãƒ ç”»é¢ã‚’è¡¨ç¤º
            document.getElementById('homeContainer').classList.remove('hidden');
            
            // ãƒ›ãƒ¼ãƒ ç”»é¢ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
            updateHomeStats();
            updateCategoryGrid();
            updateRecentHistory();
        }

        // ç®¡ç†è€…ç”»é¢æ©Ÿèƒ½
        function showAdminPanel() {
            // å…¨ã¦ã®ç”»é¢ã‚’éè¡¨ç¤º
            document.getElementById('homeContainer').classList.add('hidden');
            document.getElementById('setupPanel').classList.add('hidden');
            document.getElementById('quizContainer').classList.add('hidden');
            document.getElementById('resultContainer').classList.add('hidden');
            document.getElementById('analyticsContainer').classList.add('hidden');
            document.getElementById('detailedResults').classList.add('hidden');
            
            // ç®¡ç†è€…ç”»é¢ã‚’è¡¨ç¤º
            document.getElementById('adminContainer').classList.remove('hidden');
            
            // ç®¡ç†è€…ç”»é¢ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
            updateAdminDashboard();
        }

        function hideAdminPanel() {
            document.getElementById('adminContainer').classList.add('hidden');
            showHome();
        }

        function updateAdminDashboard() {
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆ
            const userStats = getUserStats();
            document.getElementById('adminTotalUsers').textContent = userStats.totalUsers;
            document.getElementById('adminTodayLogins').textContent = userStats.todayLogins;
            document.getElementById('adminWeeklyLogins').textContent = userStats.weeklyLogins;
            document.getElementById('adminPremiumUsers').textContent = userStats.planStats.premium;
            document.getElementById('adminFreeUsers').textContent = userStats.planStats.free;
            document.getElementById('adminPremiumUsersDetail').textContent = userStats.planStats.premium;
            document.getElementById('adminAdminUsers').textContent = userStats.planStats.admin;
            
            // åŸºæœ¬çµ±è¨ˆ
            const totalQuestions = originalQuestions.length;
            const categories = [...new Set(originalQuestions.map(q => q.category || 'æœªåˆ†é¡'))];
            const lastUpdate = localStorage.getItem('lastDataUpdate') || 'æœªæ›´æ–°';
            
            document.getElementById('adminTotalQuestions').textContent = totalQuestions;
            document.getElementById('adminTotalCategories').textContent = categories.length;
            document.getElementById('adminLastUpdate').textContent = lastUpdate;
            
            // ä¿å­˜ã•ã‚ŒãŸã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLã‚’å¾©å…ƒ
            const savedUrl = localStorage.getItem('spreadsheetUrl');
            if (savedUrl) {
                document.getElementById('spreadsheetUrl').value = savedUrl;
            }
            
            // ã‚«ãƒ†ã‚´ãƒªåˆ¥å•é¡Œæ•°
            updateAdminCategoryBreakdown();
        }

        function updateAdminCategoryBreakdown() {
            const container = document.getElementById('adminCategoryBreakdown');
            container.innerHTML = '';
            
            if (originalQuestions.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-4">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            const categoryStats = {};
            originalQuestions.forEach(q => {
                const category = q.category || 'æœªåˆ†é¡';
                const difficulty = q.difficulty || 'æœªè¨­å®š';
                
                if (!categoryStats[category]) {
                    categoryStats[category] = { total: 0, difficulties: {} };
                }
                categoryStats[category].total++;
                
                if (!categoryStats[category].difficulties[difficulty]) {
                    categoryStats[category].difficulties[difficulty] = 0;
                }
                categoryStats[category].difficulties[difficulty]++;
            });
            
            Object.entries(categoryStats).forEach(([category, stats]) => {
                const categoryCard = document.createElement('div');
                categoryCard.className = 'bg-gray-50 p-4 rounded-lg border';
                
                const difficultyBreakdown = Object.entries(stats.difficulties)
                    .map(([diff, count]) => `${diff}: ${count}å•`)
                    .join(', ');
                
                categoryCard.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <span class="font-medium text-gray-800">${category}</span>
                            <div class="text-sm text-gray-600 mt-1">${difficultyBreakdown}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-blue-600">${stats.total}</div>
                            <div class="text-xs text-gray-500">å•</div>
                        </div>
                    </div>
                `;
                
                container.appendChild(categoryCard);
            });
        }

        function exportData() {
            if (originalQuestions.length === 0) {
                alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const csvContent = convertToCSV(originalQuestions);
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `quiz_data_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function convertToCSV(questions) {
            const headers = ['å•é¡Œæ–‡', 'ã‚¿ã‚¤ãƒ—', 'é¸æŠè‚¢', 'æ­£è§£', 'ã‚«ãƒ†ã‚´ãƒª', 'é›£æ˜“åº¦', 'è§£èª¬'];
            const csvRows = [headers.join(',')];
            
            questions.forEach(q => {
                const row = [
                    `"${q.question.replace(/"/g, '""')}"`,
                    q.type,
                    `"${q.options.join(',')}"`,
                    `"${q.correct.join(',')}"`,
                    q.category || 'æœªåˆ†é¡',
                    q.difficulty || 'æœªè¨­å®š',
                    `"${(q.explanation || '').replace(/"/g, '""')}"`
                ];
                csvRows.push(row.join(','));
            });
            
            return csvRows.join('\n');
        }

        function clearAllData() {
            if (confirm('ã™ã¹ã¦ã®å•é¡Œãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                originalQuestions = [];
                questions = [];
                localStorage.removeItem('lastDataUpdate');
                localStorage.removeItem('quizQuestions');
                localStorage.removeItem('spreadsheetUrl');
                
                updateAdminDashboard();
                
                // ãƒ›ãƒ¼ãƒ ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯æ›´æ–°
                if (!document.getElementById('homeContainer').classList.contains('hidden')) {
                    updateCategoryGrid();
                    updateHomeStats();
                    updateRecentHistory();
                }
                
                alert('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            }
        }

        function resetToSample() {
            if (confirm('ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯å¤±ã‚ã‚Œã¾ã™ã€‚')) {
                loadSampleData();
                updateAdminDashboard();
                alert('ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
            }
        }

        function updateHomeStats() {
            // Phase 2: ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¦ç´ ã®æ›´æ–°
            updateLevelDisplay();
            updateDailyGoalsDisplay();
            updateRecentBadges();
            
            if (quizHistory.length === 0) {
                document.getElementById('homeTotalQuizzes').textContent = '0';
                document.getElementById('homeAverageScore').textContent = '0%';
                document.getElementById('homeStreak').textContent = '0æ—¥';
                document.getElementById('homeBestStreak').textContent = '0';
                document.getElementById('homeLevel').textContent = 'Lv.1';
                return;
            }

            const totalQuizzes = quizHistory.length;
            const averageScore = Math.round(
                quizHistory.reduce((sum, quiz) => sum + quiz.accuracy, 0) / totalQuizzes
            );
            const streak = learningStreak.current;
            const bestStreak = learningStreak.best;

            document.getElementById('homeTotalQuizzes').textContent = totalQuizzes;
            document.getElementById('homeAverageScore').textContent = averageScore + '%';
            document.getElementById('homeStreak').textContent = streak + 'æ—¥';
            document.getElementById('homeBestStreak').textContent = bestStreak;
            document.getElementById('homeLevel').textContent = `Lv.${userLevel.level}`;
        }
        
        function updateLevelDisplay() {
            document.getElementById('userLevelDisplay').textContent = `Lv.${userLevel.level}`;
            document.getElementById('totalXPDisplay').textContent = userLevel.totalXP.toLocaleString();
            
            // æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¾ã§ã®XPè¨ˆç®—
            const nextLevelXP = levelThresholds[userLevel.level] || levelThresholds[levelThresholds.length - 1];
            const currentLevelXP = levelThresholds[userLevel.level - 1] || 0;
            const currentXP = userLevel.totalXP - currentLevelXP;
            const xpToNext = nextLevelXP - userLevel.totalXP;
            
            document.getElementById('userXPDisplay').textContent = `${currentXP.toLocaleString()} / ${(nextLevelXP - currentLevelXP).toLocaleString()} XP`;
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
            const progressPercent = (currentXP / (nextLevelXP - currentLevelXP)) * 100;
            document.getElementById('xpProgressBar').style.width = `${Math.min(progressPercent, 100)}%`;
        }
        
        function updateDailyGoalsDisplay() {
            const today = new Date().toDateString();
            initializeDailyGoals();
            
            const todayGoals = dailyGoals[today];
            const container = document.getElementById('dailyGoalsContainer');
            
            container.innerHTML = `
                <div class="text-center">
                    <div class="text-2xl mb-2">ğŸ“</div>
                    <div class="text-sm text-gray-600 mb-1">ã‚¯ã‚¤ã‚ºå®Œäº†</div>
                    <div class="text-lg font-bold text-blue-600">${todayGoals.progress.quizzesCompleted} / ${todayGoals.goals.quizzes}</div>
                    <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                        <div class="bg-blue-500 rounded-full h-2 transition-all" style="width: ${Math.min((todayGoals.progress.quizzesCompleted / todayGoals.goals.quizzes) * 100, 100)}%"></div>
                    </div>
                </div>
                <div class="text-center">
                    <div class="text-2xl mb-2">â“</div>
                    <div class="text-sm text-gray-600 mb-1">å•é¡Œæ•°</div>
                    <div class="text-lg font-bold text-green-600">${todayGoals.progress.questionsAnswered} / ${todayGoals.goals.questions}</div>
                    <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                        <div class="bg-green-500 rounded-full h-2 transition-all" style="width: ${Math.min((todayGoals.progress.questionsAnswered / todayGoals.goals.questions) * 100, 100)}%"></div>
                    </div>
                </div>
                <div class="text-center">
                    <div class="text-2xl mb-2">â­</div>
                    <div class="text-sm text-gray-600 mb-1">XPç²å¾—</div>
                    <div class="text-lg font-bold text-purple-600">${todayGoals.progress.xpEarned} / ${todayGoals.goals.xp}</div>
                    <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                        <div class="bg-purple-500 rounded-full h-2 transition-all" style="width: ${Math.min((todayGoals.progress.xpEarned / todayGoals.goals.xp) * 100, 100)}%"></div>
                    </div>
                </div>
            `;
        }
        
        function updateRecentBadges() {
            const container = document.getElementById('recentBadgesContainer');
            
            if (achievements.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-4 w-full">ã¾ã ãƒãƒƒã‚¸ã‚’ç²å¾—ã—ã¦ã„ã¾ã›ã‚“</div>';
                return;
            }
            
            const recentBadges = achievements.slice(-6); // æœ€æ–°6å€‹
            container.innerHTML = '';
            
            recentBadges.forEach(badgeId => {
                const badge = badgeDefinitions[badgeId];
                if (!badge) return;
                
                const rarityColors = {
                    'common': 'border-gray-300 bg-gray-50',
                    'uncommon': 'border-green-300 bg-green-50',
                    'rare': 'border-blue-300 bg-blue-50',
                    'epic': 'border-purple-300 bg-purple-50',
                    'legendary': 'border-yellow-300 bg-yellow-50'
                };
                
                const badgeElement = document.createElement('div');
                badgeElement.className = `${rarityColors[badge.rarity]} border-2 rounded-lg p-3 text-center min-w-[80px] hover:scale-105 transition-transform cursor-pointer`;
                badgeElement.innerHTML = `
                    <div class="text-2xl mb-1">${badge.icon}</div>
                    <div class="text-xs font-medium text-gray-700">${badge.name}</div>
                `;
                badgeElement.title = badge.description;
                
                container.appendChild(badgeElement);
            });
        }
        
        function showAllBadges() {
            document.getElementById('badgeModal').classList.remove('hidden');
            updateAllBadgesDisplay();
        }
        
        function closeBadgeModal() {
            document.getElementById('badgeModal').classList.add('hidden');
        }
        
        function updateAllBadgesDisplay() {
            const container = document.getElementById('allBadgesContainer');
            const totalBadges = Object.keys(badgeDefinitions).length;
            const earnedBadges = achievements.length;
            const completionRate = Math.round((earnedBadges / totalBadges) * 100);
            
            document.getElementById('earnedBadgeCount').textContent = earnedBadges;
            document.getElementById('totalBadgeCount').textContent = totalBadges;
            document.getElementById('badgeCompletionRate').textContent = completionRate + '%';
            document.getElementById('badgeProgressBar').style.width = completionRate + '%';
            
            container.innerHTML = '';
            
            Object.entries(badgeDefinitions).forEach(([badgeId, badge]) => {
                const isEarned = achievements.includes(badgeId);
                
                const rarityColors = {
                    'common': isEarned ? 'border-gray-400 bg-gray-100' : 'border-gray-200 bg-gray-50',
                    'uncommon': isEarned ? 'border-green-400 bg-green-100' : 'border-green-200 bg-green-50',
                    'rare': isEarned ? 'border-blue-400 bg-blue-100' : 'border-blue-200 bg-blue-50',
                    'epic': isEarned ? 'border-purple-400 bg-purple-100' : 'border-purple-200 bg-purple-50',
                    'legendary': isEarned ? 'border-yellow-400 bg-yellow-100' : 'border-yellow-200 bg-yellow-50'
                };
                
                const badgeElement = document.createElement('div');
                badgeElement.className = `${rarityColors[badge.rarity]} border-2 rounded-lg p-4 text-center ${isEarned ? '' : 'opacity-50'}`;
                badgeElement.innerHTML = `
                    <div class="text-3xl mb-2 ${isEarned ? '' : 'grayscale'}">${badge.icon}</div>
                    <div class="font-bold text-sm mb-1">${badge.name}</div>
                    <div class="text-xs text-gray-600 mb-2">${badge.description}</div>
                    <div class="text-xs px-2 py-1 rounded-full ${isEarned ? 'bg-green-200 text-green-800' : 'bg-gray-200 text-gray-600'}">
                        ${isEarned ? 'ç²å¾—æ¸ˆã¿' : 'æœªç²å¾—'}
                    </div>
                `;
                
                container.appendChild(badgeElement);
            });
        }

        function updateCategoryGrid() {
            const container = document.getElementById('categoryGrid');
            container.innerHTML = '';
            
            // ã‚«ãƒ†ã‚´ãƒªã‚¢ã‚¤ã‚³ãƒ³ãƒãƒƒãƒ”ãƒ³ã‚°
            const categoryIcons = {
                'SEO': 'ğŸ”',
                'HTML': 'ğŸ—ï¸',
                'åºƒå‘Š': 'ğŸ“¢',
                'CSS': 'ğŸ¨',
                'ãƒªãƒ†ãƒ©ã‚·ãƒ¼': 'ğŸ›¡ï¸',
                'WordPress': 'ğŸ“',
                'ãƒ¡ãƒ¼ãƒ«': 'ğŸ“§',
                'ã‚³ãƒ³ãƒ†ãƒ³ãƒ„': 'ğŸ“„',
                'EC': 'ğŸ›’',
                'AI': 'ğŸ¤–'
            };
            
            if (originalQuestions.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
                return;
            }
            
            const categories = [...new Set(originalQuestions.map(q => q.category || 'æœªåˆ†é¡'))].sort();
            
            categories.forEach(category => {
                const categoryQuestions = originalQuestions.filter(q => (q.category || 'æœªåˆ†é¡') === category);
                const icon = categoryIcons[category] || 'ğŸ“';
                
                // ãƒ—ãƒ©ãƒ³åˆ¶é™ãƒã‚§ãƒƒã‚¯
                const freeQuestions = categoryQuestions.filter(q => (q.difficulty || 'æœªè¨­å®š') === 'åˆç´š');
                const isLocked = currentUser.plan === 'free' && freeQuestions.length === 0;
                
                // åˆ©ç”¨å¯èƒ½ãªå•é¡Œæ•°ã‚’è¨ˆç®—
                let availableCount = categoryQuestions.length;
                let displayText = `${availableCount}å•`;
                
                if (currentUser.plan === 'free') {
                    availableCount = freeQuestions.length;
                    if (availableCount < categoryQuestions.length) {
                        displayText = `${availableCount}å• (åˆç´šã®ã¿)`;
                    }
                }
                
                const card = document.createElement('div');
                card.className = `canva-card rounded-2xl p-4 sm:p-6 text-center cursor-pointer transition-all hover:scale-105 hover:shadow-lg ${isLocked ? 'opacity-60' : ''}`;
                
                card.innerHTML = `
                    <div class="text-3xl sm:text-4xl mb-3">${icon}</div>
                    <h4 class="font-bold text-gray-800 mb-2 text-sm sm:text-base">${category}</h4>
                    <p class="text-xs sm:text-sm text-gray-600 mb-3">${displayText}</p>
                    ${isLocked ? 
                        '<div class="text-xs text-orange-600 font-medium">ğŸ”’ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é™å®š</div>' : 
                        '<div class="text-xs text-green-600 font-medium">âœ“ åˆ©ç”¨å¯èƒ½</div>'
                    }
                `;
                
                card.onclick = () => {
                    if (isLocked) {
                        showUpgradeModal();
                    } else {
                        selectCategory(category);
                    }
                };
                
                container.appendChild(card);
            });
        }

        function selectCategory(category) {
            selectedCategory = category;
            
            // è¨­å®šç”»é¢ã‚’è¡¨ç¤º
            document.getElementById('homeContainer').classList.add('hidden');
            document.getElementById('setupPanel').classList.remove('hidden');
            
            // é›£æ˜“åº¦é¸æŠè‚¢ã‚’æ›´æ–°
            updateDifficultyOptions(category);
        }

        function updateDifficultyOptions(category) {
            const difficultySelect = document.getElementById('difficultySelect');
            
            let categoryQuestions = originalQuestions;
            if (category !== 'all') {
                categoryQuestions = categoryQuestions.filter(q => (q.category || 'æœªåˆ†é¡') === category);
            }
            
            const difficulties = [...new Set(categoryQuestions.map(q => q.difficulty || 'æœªè¨­å®š'))].sort();
            
            difficultySelect.innerHTML = '';
            
            // ã€Œã™ã¹ã¦ã®é›£æ˜“åº¦ã€ã®å•é¡Œæ•°ã‚’è¨ˆç®—
            const allDifficultyOption = document.createElement('option');
            allDifficultyOption.value = 'all';
            allDifficultyOption.textContent = `ã™ã¹ã¦ã®é›£æ˜“åº¦ (${categoryQuestions.length}å•)`;
            difficultySelect.appendChild(allDifficultyOption);
            
            // å„é›£æ˜“åº¦ã®å•é¡Œæ•°ã‚’è¨ˆç®—
            difficulties.forEach(difficulty => {
                const difficultyQuestions = categoryQuestions.filter(q => (q.difficulty || 'æœªè¨­å®š') === difficulty);
                
                const option = document.createElement('option');
                option.value = difficulty;
                option.textContent = `${difficulty} (${difficultyQuestions.length}å•)`;
                difficultySelect.appendChild(option);
            });
            
            // å•é¡Œæ•°è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('difficultyCount').textContent = categoryQuestions.length;
        }

        function updateRecentHistory() {
            const container = document.getElementById('recentHistory');
            
            if (quizHistory.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">ã¾ã å­¦ç¿’å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>ã‚¯ã‚¤ã‚ºã«æŒ‘æˆ¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</div>';
                return;
            }
            
            const recentQuizzes = quizHistory.slice(-5).reverse();
            
            container.innerHTML = '';
            recentQuizzes.forEach((quiz, index) => {
                const date = new Date(quiz.date);
                const dateStr = date.toLocaleDateString('ja-JP', { 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const historyItem = document.createElement('div');
                historyItem.className = 'flex items-center justify-between p-3 sm:p-4 bg-gray-50 rounded-lg fade-in';
                historyItem.style.animationDelay = `${index * 0.1}s`;
                
                const accuracyColor = quiz.accuracy >= 80 ? 'text-green-600' : quiz.accuracy >= 60 ? 'text-yellow-600' : 'text-red-600';
                
                historyItem.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="text-lg sm:text-xl">${quiz.accuracy >= 80 ? 'ğŸ†' : quiz.accuracy >= 60 ? 'ğŸ‘' : 'ğŸ“š'}</div>
                        <div>
                            <div class="font-medium text-gray-800 text-sm sm:text-base">${quiz.category || 'ã™ã¹ã¦'}</div>
                            <div class="text-xs sm:text-sm text-gray-500">${dateStr}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold ${accuracyColor} text-sm sm:text-base">${quiz.accuracy}%</div>
                        <div class="text-xs sm:text-sm text-gray-500">${quiz.score}/${quiz.total}å•</div>
                    </div>
                `;
                
                container.appendChild(historyItem);
            });
        }

        function showUpgradeModal() {
            document.getElementById('upgradeModal').classList.remove('hidden');
        }

        function closeUpgradeModal() {
            document.getElementById('upgradeModal').classList.add('hidden');
        }

        function upgradeToPremium() {
            // ãƒ‡ãƒ¢ç‰ˆã§ã¯å³åº§ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
            currentUser.plan = 'premium';
            
            // æ›´æ–°ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ä¿å­˜
            saveUserSession(currentUser);
            
            alert('ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼\nä¸­ç´šãƒ»ä¸Šç´šå•é¡Œã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚');
            closeUpgradeModal();
            showMainApp();
            
            // Google Analytics ã‚¤ãƒ™ãƒ³ãƒˆ
            if (typeof gtag !== 'undefined') {
                gtag('event', 'purchase', {
                    transaction_id: 'demo_upgrade_' + Date.now(),
                    value: 980,
                    currency: 'JPY',
                    items: [{
                        item_id: 'premium_plan',
                        item_name: 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³',
                        category: 'subscription',
                        quantity: 1,
                        price: 980
                    }]
                });
            }
        }

        function refreshSpreadsheetData() {
            const savedUrl = localStorage.getItem('spreadsheetUrl');
            if (!savedUrl) {
                alert('ä¿å­˜ã•ã‚ŒãŸã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLãŒã‚ã‚Šã¾ã›ã‚“ã€‚\næœ€åˆã«ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„ã€‚');
                return;
            }
            
            // ä¿å­˜ã•ã‚ŒãŸURLã‚’å…¥åŠ›æ¬„ã«è¨­å®š
            document.getElementById('spreadsheetUrl').value = savedUrl;
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿
            loadFromSpreadsheet();
        }

        function loadSampleData() {
            originalQuestions = [...sampleQuestions];
            questions = [...originalQuestions];
            
            // æœ€çµ‚æ›´æ–°æ™‚åˆ»ã‚’ä¿å­˜
            const now = new Date().toLocaleString('ja-JP');
            localStorage.setItem('lastDataUpdate', now);
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            localStorage.setItem('quizQuestions', JSON.stringify(originalQuestions));
            
            // å…¨ã¦ã®ç”»é¢ã‚’å¼·åˆ¶æ›´æ–°
            updateAdminDashboard();
            updateCategoryGrid();
            updateHomeStats();
            updateRecentHistory();
            updateDifficultyOptions(selectedCategory);
            
            console.log('ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', originalQuestions.length + 'å•');
        }



        function validateQuestions(questionsToValidate) {
            const errors = [];
            const warnings = [];
            let validCount = 0;

            questionsToValidate.forEach((q, index) => {
                const questionNum = index + 1;
                
                // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯
                if (!q.question || q.question.trim() === '') {
                    errors.push(`å•é¡Œ${questionNum}: å•é¡Œæ–‡ãŒç©ºã§ã™`);
                }
                if (!q.type || !['single', 'multiple', 'truefalse'].includes(q.type)) {
                    errors.push(`å•é¡Œ${questionNum}: å•é¡Œã‚¿ã‚¤ãƒ—ãŒç„¡åŠ¹ã§ã™ (single, multiple, truefalse ã®ã„ãšã‚Œã‹ã‚’æŒ‡å®š)`);
                }
                if (!q.options || q.options.length === 0) {
                    errors.push(`å•é¡Œ${questionNum}: é¸æŠè‚¢ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“`);
                }
                if (!q.correct || q.correct.length === 0) {
                    errors.push(`å•é¡Œ${questionNum}: æ­£è§£ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“`);
                }

                // é¸æŠè‚¢ã¨æ­£è§£ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ï¼ˆæ–‡å­—ã®æ­£è¦åŒ–å¯¾å¿œï¼‰
                if (q.options && q.correct) {
                    q.correct.forEach(correctAnswer => {
                        const normalizedCorrect = normalizeText(correctAnswer);
                        const hasMatch = q.options.some(option => normalizeText(option) === normalizedCorrect);
                        
                        if (!hasMatch) {
                            errors.push(`å•é¡Œ${questionNum}: æ­£è§£ã€Œ${correctAnswer}ã€ãŒé¸æŠè‚¢ã«å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“`);
                        }
                    });
                }

                // å•é¡Œã‚¿ã‚¤ãƒ—åˆ¥ãƒã‚§ãƒƒã‚¯
                if (q.type === 'truefalse' && q.options && q.options.length !== 2) {
                    warnings.push(`å•é¡Œ${questionNum}: â—‹Ã—å•é¡Œã¯é¸æŠè‚¢ãŒ2ã¤ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™`);
                }
                if (q.type === 'single' && q.correct && q.correct.length > 1) {
                    warnings.push(`å•é¡Œ${questionNum}: æŠä¸€é¸æŠå•é¡Œã®æ­£è§£ã¯1ã¤ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™`);
                }

                if (errors.length === 0) validCount++;
            });

            return {
                isValid: errors.length === 0,
                totalQuestions: questionsToValidate.length,
                validQuestions: validCount,
                errors: errors,
                warnings: warnings
            };
        }

        function showValidationResults(validation) {
            const container = document.getElementById('validationResults');
            container.innerHTML = '';
            
            if (validation.errors.length === 0 && validation.warnings.length === 0) {
                container.innerHTML = `
                    <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                        <div class="flex items-center">
                            <span class="text-green-600 mr-2">âœ…</span>
                            <span class="text-green-700 font-medium">ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼å®Œäº†: ${validation.totalQuestions}å•ã™ã¹ã¦æ­£å¸¸ã§ã™</span>
                        </div>
                    </div>
                `;
            } else {
                let html = '<div class="space-y-3">';
                
                if (validation.errors.length > 0) {
                    html += `
                        <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                            <div class="font-medium text-red-800 mb-2">âŒ ã‚¨ãƒ©ãƒ¼ (${validation.errors.length}ä»¶)</div>
                            <ul class="text-sm text-red-700 space-y-1">
                                ${validation.errors.map(error => `<li>â€¢ ${error}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                if (validation.warnings.length > 0) {
                    html += `
                        <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <div class="font-medium text-yellow-800 mb-2">âš ï¸ è­¦å‘Š (${validation.warnings.length}ä»¶)</div>
                            <ul class="text-sm text-yellow-700 space-y-1">
                                ${validation.warnings.map(warning => `<li>â€¢ ${warning}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                html += '</div>';
                container.innerHTML = html;
            }
            
            container.classList.remove('hidden');
        }

        async function loadFromSpreadsheet() {
            const url = document.getElementById('spreadsheetUrl').value.trim();
            if (!url) {
                alert('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            try {
                // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’æŠ½å‡º
                const sheetId = extractSheetId(url);
                if (!sheetId) {
                    throw new Error('ç„¡åŠ¹ãªã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLã§ã™');
                }
                
                // CSVå½¢å¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆå…¬é–‹è¨­å®šãŒå¿…è¦ï¼‰
                const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=0`;
                
                document.getElementById('loadingMessage').classList.remove('hidden');
                
                const response = await fetch(csvUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const csvText = await response.text();
                const parsedQuestions = parseCSV(csvText);
                
                if (parsedQuestions.length === 0) {
                    throw new Error('å•é¡Œãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                }
                
                originalQuestions = parsedQuestions;
                const validation = validateQuestions(originalQuestions);
                showValidationResults(validation);
                
                document.getElementById('loadingMessage').classList.add('hidden');
                
                if (validation.isValid) {
                    questions = [...originalQuestions];
                    
                    // æœ€çµ‚æ›´æ–°æ™‚åˆ»ã‚’ä¿å­˜
                    const now = new Date().toLocaleString('ja-JP');
                    localStorage.setItem('lastDataUpdate', now);
                    
                    // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLã‚’ä¿å­˜
                    localStorage.setItem('spreadsheetUrl', url);
                    
                    // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                    localStorage.setItem('quizQuestions', JSON.stringify(originalQuestions));
                    
                    alert(`${questions.length}å•ã®å•é¡Œã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼`);
                    
                    // å…¨ã¦ã®ç”»é¢ã‚’å¼·åˆ¶æ›´æ–°
                    updateAdminDashboard();
                    updateCategoryGrid();
                    updateHomeStats();
                    updateRecentHistory();
                    
                    // è¨­å®šç”»é¢ã®é›£æ˜“åº¦é¸æŠè‚¢ã‚‚æ›´æ–°
                    updateDifficultyOptions(selectedCategory);
                    
                    console.log('ãƒ‡ãƒ¼ã‚¿æ›´æ–°å®Œäº†:', originalQuestions.length + 'å•');
                } else {
                    alert(`ãƒ‡ãƒ¼ã‚¿ã«ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚${validation.errors.length}ä»¶ã®ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚`);
                }
                
            } catch (error) {
                document.getElementById('loadingMessage').classList.add('hidden');
                console.error('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                alert(`ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}\n\nç¢ºèªäº‹é …:\n1. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒã€Œãƒªãƒ³ã‚¯ã‚’çŸ¥ã£ã¦ã„ã‚‹å…¨å“¡ãŒé–²è¦§å¯èƒ½ã€ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹\n2. URLãŒæ­£ã—ã„ã‹\n3. ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ã„å½¢å¼ã§å…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã‹`);
            }
        }

        function extractSheetId(url) {
            const match = url.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
            return match ? match[1] : null;
        }

        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim());
            const questions = [];
            
            // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆã‚‚ã—ã‚ã‚Œã°ï¼‰
            const startIndex = lines[0].includes('å•é¡Œæ–‡') ? 1 : 0;
            
            for (let i = startIndex; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                // CSVã®è¡Œã‚’è§£æï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã€ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆå¯¾å¿œï¼‰
                const columns = parseCSVLine(line);
                
                if (columns.length >= 4) {
                    const [questionText, type, optionsStr, correctStr, categoryStr, difficultyStr, explanationStr] = columns;
                    
                    if (questionText && type && optionsStr && correctStr) {
                        const options = optionsStr.split(',').map(opt => normalizeText(opt));
                        const correct = correctStr.split(',').map(ans => normalizeText(ans));
                        const category = categoryStr ? categoryStr.trim() : 'æœªåˆ†é¡';
                        const difficulty = difficultyStr ? difficultyStr.trim() : 'æœªè¨­å®š';
                        const explanation = explanationStr ? explanationStr.trim() : '';
                        
                        questions.push({
                            question: questionText.trim(),
                            type: type.trim(),
                            options: options,
                            correct: correct,
                            category: category,
                            difficulty: difficulty,
                            explanation: explanation
                        });
                    }
                }
            }
            
            return questions;
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current);
            return result;
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function startQuiz() {
            if (originalQuestions.length === 0) {
                alert('å•é¡Œãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            // ã‚«ãƒ†ã‚´ãƒªã¨é›£æ˜“åº¦ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            const selectedDifficulty = document.getElementById('difficultySelect').value;
            let filteredQuestions = [...originalQuestions];
            
            if (selectedCategory !== 'all') {
                filteredQuestions = filteredQuestions.filter(q => (q.category || 'æœªåˆ†é¡') === selectedCategory);
            }
            
            if (selectedDifficulty !== 'all') {
                filteredQuestions = filteredQuestions.filter(q => (q.difficulty || 'æœªè¨­å®š') === selectedDifficulty);
            }
            
            // ãƒ—ãƒ©ãƒ³åˆ¶é™ãƒã‚§ãƒƒã‚¯
            if (currentUser.plan === 'free') {
                const restrictedQuestions = filteredQuestions.filter(q => 
                    (q.difficulty || 'æœªè¨­å®š') === 'ä¸­ç´š' || (q.difficulty || 'æœªè¨­å®š') === 'ä¸Šç´š'
                );
                
                if (restrictedQuestions.length > 0) {
                    const freeQuestions = filteredQuestions.filter(q => (q.difficulty || 'æœªè¨­å®š') === 'åˆç´š');
                    
                    if (freeQuestions.length === 0) {
                        alert('é¸æŠã•ã‚ŒãŸæ¡ä»¶ã®å•é¡Œã¯ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³é™å®šã§ã™ã€‚\nç„¡æ–™ãƒ—ãƒ©ãƒ³ã§ã¯åˆç´šå•é¡Œã®ã¿ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚');
                        showUpgradeModal();
                        return;
                    } else {
                        const confirmResult = confirm(
                            `é¸æŠã•ã‚ŒãŸæ¡ä»¶ã«ã¯ä¸­ç´šãƒ»ä¸Šç´šå•é¡ŒãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚\n` +
                            `ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§ã¯åˆç´šå•é¡Œï¼ˆ${freeQuestions.length}å•ï¼‰ã®ã¿åˆ©ç”¨å¯èƒ½ã§ã™ã€‚\n\n` +
                            `åˆç´šå•é¡Œã®ã¿ã§ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ`
                        );
                        
                        if (!confirmResult) {
                            return;
                        }
                        
                        filteredQuestions = freeQuestions;
                    }
                }
            }
            
            if (filteredQuestions.length === 0) {
                alert('é¸æŠã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªã«å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            // å•é¡Œæ•°åˆ¶é™
            const questionLimit = document.getElementById('questionLimit').value;
            if (questionLimit !== 'all') {
                const limit = parseInt(questionLimit);
                if (filteredQuestions.length > limit) {
                    filteredQuestions = filteredQuestions.slice(0, limit);
                }
            }

            // ã‚·ãƒ£ãƒƒãƒ•ãƒ«è¨­å®šã®ç¢ºèª
            const shuffleMode = document.getElementById('shuffleMode').value;
            if (shuffleMode === 'shuffle') {
                questions = shuffleArray(filteredQuestions);
            } else {
                questions = [...filteredQuestions];
            }

            // ã‚¿ã‚¤ãƒãƒ¼è¨­å®š
            const timeLimitMinutes = parseInt(document.getElementById('timeLimit').value);
            if (timeLimitMinutes > 0) {
                timeRemaining = timeLimitMinutes * 60; // ç§’ã«å¤‰æ›
                document.getElementById('timerDisplay').classList.remove('hidden');
                startTimer();
            } else {
                document.getElementById('timerDisplay').classList.add('hidden');
            }

            document.getElementById('setupPanel').classList.add('hidden');
            document.getElementById('quizContainer').classList.remove('hidden');
            
            currentQuestionIndex = 0;
            userAnswers = [];
            selectedAnswers.clear();
            quizStartTime = new Date();
            
            displayQuestion();
            
            // Google Analytics ã‚¤ãƒ™ãƒ³ãƒˆ
            if (typeof gtag !== 'undefined') {
                gtag('event', 'quiz_start', {
                    category: selectedCategory,
                    difficulty: selectedDifficulty,
                    question_count: questions.length
                });
            }
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    alert('æ™‚é–“åˆ‡ã‚Œã§ã™ï¼ã‚¯ã‚¤ã‚ºã‚’çµ‚äº†ã—ã¾ã™ã€‚');
                    showResults();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timeRemaining').textContent = display;
            
            // æ®‹ã‚Šæ™‚é–“ãŒå°‘ãªããªã£ãŸã‚‰è‰²ã‚’å¤‰æ›´
            const timerElement = document.getElementById('timerDisplay');
            if (timeRemaining <= 60) {
                timerElement.className = timerElement.className.replace('text-orange-600', 'text-red-600');
            } else if (timeRemaining <= 300) {
                timerElement.className = timerElement.className.replace('text-orange-600', 'text-yellow-600');
            }
        }

        function displayQuestion() {
            const question = questions[currentQuestionIndex];
            selectedAnswers.clear();
            
            // å•é¡Œæƒ…å ±ã®æ›´æ–°
            document.getElementById('questionNumber').textContent = `å•é¡Œ ${currentQuestionIndex + 1}`;
            document.getElementById('questionText').textContent = question.question;
            
            // å•é¡Œã‚¿ã‚¤ãƒ—ã€ã‚«ãƒ†ã‚´ãƒªã€é›£æ˜“åº¦ã®è¡¨ç¤º
            const typeText = {
                'single': 'æŠä¸€é¸æŠ',
                'multiple': 'è¤‡æ•°é¸æŠ',
                'truefalse': 'â—‹Ã—å•é¡Œ'
            };
            document.getElementById('questionType').textContent = typeText[question.type] || 'æŠä¸€é¸æŠ';
            document.getElementById('questionCategory').textContent = question.category || 'æœªåˆ†é¡';
            document.getElementById('questionDifficulty').textContent = question.difficulty || 'æœªè¨­å®š';
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®æ›´æ–°
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${currentQuestionIndex + 1} / ${questions.length}`;
            
            // é¸æŠè‚¢ã®ç”Ÿæˆ
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-button w-full bg-white hover:bg-gray-50 text-gray-800 p-4 rounded-lg border-2 border-gray-200 text-left font-medium fade-in';
                button.style.animationDelay = `${index * 0.1}s`;
                button.innerHTML = `
                    <div class="flex items-center">
                        <span class="w-8 h-8 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center text-sm font-bold mr-4">
                            ${String.fromCharCode(65 + index)}
                        </span>
                        <span>${option}</span>
                    </div>
                `;
                
                button.onclick = () => selectOption(button, option, question.type);
                container.appendChild(button);
            });
            
            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            document.getElementById('prevButton').disabled = currentQuestionIndex === 0;
            const nextButton = document.getElementById('nextButton');
            nextButton.textContent = currentQuestionIndex === questions.length - 1 ? 'çµæœã‚’è¦‹ã‚‹' : 'æ¬¡ã®å•é¡Œ â†’';
            
            // è¤‡æ•°é¸æŠä»¥å¤–ã¯æ¬¡ã¸ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ï¼ˆå›ç­”å¾Œã«æœ‰åŠ¹åŒ–ï¼‰
            if (question.type === 'single' || question.type === 'truefalse') {
                nextButton.disabled = true;
                nextButton.style.opacity = '0.5';
            } else {
                nextButton.disabled = false;
                nextButton.style.opacity = '1';
            }
            
            // åºƒå‘Šè¡¨ç¤ºåˆ¶å¾¡ï¼ˆ5å•ã”ã¨ã€ç„¡æ–™ãƒ—ãƒ©ãƒ³ã®ã¿ï¼‰
            if (currentUser.plan === 'free' && currentQuestionIndex > 0 && currentQuestionIndex % 5 === 0) {
                document.getElementById('adSpace4').style.display = 'block';
            } else {
                document.getElementById('adSpace4').style.display = 'none';
            }
        }

        function selectOption(button, option, type) {
            if (type === 'single' || type === 'truefalse') {
                // å˜ä¸€é¸æŠï¼šä»–ã®é¸æŠã‚’è§£é™¤
                document.querySelectorAll('.option-button').forEach(btn => {
                    btn.classList.remove('option-selected');
                });
                
                button.classList.add('option-selected');
                createParticles(button);
                
                selectedAnswers.clear();
                selectedAnswers.add(option);
                
                // å³åº§ã«æ­£èª¤åˆ¤å®šã‚’è¡¨ç¤º
                showAnswerFeedback(option, type);
                
            } else if (type === 'multiple') {
                // è¤‡æ•°é¸æŠï¼šãƒˆã‚°ãƒ«
                if (selectedAnswers.has(option)) {
                    selectedAnswers.delete(option);
                    button.classList.remove('option-selected');
                } else {
                    selectedAnswers.add(option);
                    button.classList.add('option-selected');
                    createParticles(button);
                }
            }
        }

        function showAnswerFeedback(selectedOption, type) {
            const question = questions[currentQuestionIndex];
            const correctAnswers = question.correct;
            
            // å˜ä¸€é¸æŠãƒ»â—‹Ã—å•é¡Œã®å ´åˆã®ã¿å³åº§ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            if (type === 'single' || type === 'truefalse') {
                const isCorrect = correctAnswers.includes(selectedOption);
                
                // å…¨ã¦ã®é¸æŠè‚¢ã«æ­£èª¤ã‚’è¡¨ç¤º
                document.querySelectorAll('.option-button').forEach(btn => {
                    const optionText = btn.querySelector('span:last-child').textContent;
                    
                    if (correctAnswers.includes(optionText)) {
                        btn.classList.add('correct');
                        btn.classList.remove('option-button');
                    } else if (optionText === selectedOption && !isCorrect) {
                        btn.classList.add('incorrect');
                        btn.classList.remove('option-button');
                    }
                    
                    // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                    btn.disabled = true;
                    btn.style.pointerEvents = 'none';
                });
                
                // è§£èª¬ã‚’è¡¨ç¤ºï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã®ã¿ï¼‰
                if (currentUser.plan === 'premium' && question.explanation) {
                    setTimeout(() => {
                        showExplanation(question.explanation, isCorrect);
                    }, 1000);
                }
                
                // æ¬¡ã®å•é¡Œãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
                setTimeout(() => {
                    document.getElementById('nextButton').disabled = false;
                    document.getElementById('nextButton').style.opacity = '1';
                }, 1500);
            }
        }

        function showExplanation(explanation, isCorrect) {
            // æ—¢å­˜ã®è§£èª¬ã‚’å‰Šé™¤
            const existingExplanation = document.getElementById('explanationCard');
            if (existingExplanation) {
                existingExplanation.remove();
            }
            
            const explanationCard = document.createElement('div');
            explanationCard.id = 'explanationCard';
            explanationCard.className = `mt-6 p-4 rounded-lg border-l-4 ${isCorrect ? 'bg-green-50 border-green-400' : 'bg-blue-50 border-blue-400'} fade-in`;
            explanationCard.innerHTML = `
                <div class="flex items-start">
                    <div class="flex-shrink-0 mr-3">
                        <span class="text-2xl">${isCorrect ? 'âœ…' : 'ğŸ’¡'}</span>
                    </div>
                    <div>
                        <h4 class="font-semibold ${isCorrect ? 'text-green-800' : 'text-blue-800'} mb-2">
                            ${isCorrect ? 'æ­£è§£ã§ã™ï¼' : 'è§£èª¬'}
                        </h4>
                        <p class="${isCorrect ? 'text-green-700' : 'text-blue-700'}">${explanation}</p>
                    </div>
                </div>
            `;
            
            document.getElementById('optionsContainer').appendChild(explanationCard);
        }

        function nextQuestion() {
            // å›ç­”ã‚’ä¿å­˜
            userAnswers[currentQuestionIndex] = Array.from(selectedAnswers);
            
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                showResults();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
                
                // å‰ã®å›ç­”ã‚’å¾©å…ƒ
                if (userAnswers[currentQuestionIndex]) {
                    selectedAnswers = new Set(userAnswers[currentQuestionIndex]);
                    
                    document.querySelectorAll('.option-button').forEach(button => {
                        const optionText = button.querySelector('span:last-child').textContent;
                        if (selectedAnswers.has(optionText)) {
                            button.classList.add('option-selected');
                        }
                    });
                }
            }
        }

        function showResults() {
            // ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            document.getElementById('quizContainer').classList.add('hidden');
            document.getElementById('resultContainer').classList.remove('hidden');
            
            let correctCount = 0;
            const quizEndTime = new Date();
            const timeSpent = Math.round((quizEndTime - quizStartTime) / 1000); // ç§’
            
            questions.forEach((question, index) => {
                const userAnswer = userAnswers[index] || [];
                const correctAnswer = question.correct;
                
                // é…åˆ—ã®å†…å®¹ã‚’æ¯”è¼ƒ
                const isCorrect = arraysEqual(userAnswer.sort(), correctAnswer.sort());
                if (isCorrect) correctCount++;
            });
            
            const totalQuestions = questions.length;
            const incorrectCount = totalQuestions - correctCount;
            const accuracy = Math.round((correctCount / totalQuestions) * 100);
            
            document.getElementById('finalScore').textContent = `${correctCount}/${totalQuestions}`;
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('incorrectCount').textContent = incorrectCount;
            document.getElementById('accuracyRate').textContent = `${accuracy}%`;
            
            // çµæœã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            const result = {
                correctCount,
                totalQuestions,
                accuracy,
                timeSpent,
                questions: questions.map((q, index) => ({
                    question: q.question,
                    category: q.category,
                    difficulty: q.difficulty,
                    userAnswer: userAnswers[index] || [],
                    correctAnswer: q.correct,
                    isCorrect: arraysEqual((userAnswers[index] || []).sort(), q.correct.sort())
                }))
            };
            
            saveQuizResult(result);
            
            // ç§°å·ãƒã‚§ãƒƒã‚¯ï¼ˆæº€ç‚¹ã®å ´åˆã®ã¿ï¼‰
            if (correctCount === totalQuestions) {
                checkAndShowAchievement();
                createConfetti();
            }
            
            // Google Analytics ã‚¤ãƒ™ãƒ³ãƒˆ
            if (typeof gtag !== 'undefined') {
                gtag('event', 'quiz_complete', {
                    score: correctCount,
                    total: totalQuestions,
                    accuracy: accuracy,
                    time_spent: timeSpent
                });
            }
        }
        
        function checkAndShowAchievement() {
            const selectedCategory = document.getElementById('categorySelect').value;
            const selectedDifficulty = document.getElementById('difficultySelect').value;
            
            let achievementTitle = '';
            let achievementDescription = '';
            
            // ã‚«ãƒ†ã‚´ãƒªã¨é›£æ˜“åº¦ã«åŸºã¥ã„ã¦ç§°å·ã‚’æ±ºå®š
            if (selectedCategory !== 'all' && selectedDifficulty !== 'all') {
                // ç‰¹å®šã®ã‚«ãƒ†ã‚´ãƒªãƒ»é›£æ˜“åº¦
                achievementTitle = `${selectedCategory} ${selectedDifficulty}ãƒã‚¹ã‚¿ãƒ¼`;
                achievementDescription = `${selectedCategory}ã®${selectedDifficulty}ãƒ¬ãƒ™ãƒ«å•é¡Œã‚’å…¨å•æ­£è§£ã—ã¾ã—ãŸï¼`;
            } else if (selectedCategory !== 'all') {
                // ç‰¹å®šã®ã‚«ãƒ†ã‚´ãƒªï¼ˆå…¨é›£æ˜“åº¦ï¼‰
                achievementTitle = `${selectedCategory} ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ`;
                achievementDescription = `${selectedCategory}ã®å…¨é›£æ˜“åº¦å•é¡Œã‚’åˆ¶è¦‡ã—ã¾ã—ãŸï¼`;
            } else if (selectedDifficulty !== 'all') {
                // ç‰¹å®šã®é›£æ˜“åº¦ï¼ˆå…¨ã‚«ãƒ†ã‚´ãƒªï¼‰
                achievementTitle = `${selectedDifficulty} ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³`;
                achievementDescription = `${selectedDifficulty}ãƒ¬ãƒ™ãƒ«ã®å…¨ã‚«ãƒ†ã‚´ãƒªå•é¡Œã‚’åˆ¶è¦‡ã—ã¾ã—ãŸï¼`;
            } else {
                // å…¨å•é¡Œ
                achievementTitle = 'ã‚°ãƒ©ãƒ³ãƒ‰ãƒã‚¹ã‚¿ãƒ¼';
                achievementDescription = 'ã™ã¹ã¦ã®å•é¡Œã‚’å®Œç’§ã«è§£ç­”ã—ã¾ã—ãŸï¼çœŸã®é“å ´ãƒã‚¹ã‚¿ãƒ¼ã§ã™ï¼';
            }
            
            // ç§°å·è¡¨ç¤º
            document.getElementById('achievementTitle').textContent = achievementTitle;
            document.getElementById('achievementDescription').textContent = achievementDescription;
            document.getElementById('achievementSection').classList.remove('hidden');
        }

        function showDetailedResults() {
            document.getElementById('detailedResults').classList.remove('hidden');
            const container = document.getElementById('detailedResultsList');
            container.innerHTML = '';
            
            questions.forEach((question, index) => {
                const userAnswer = userAnswers[index] || [];
                const correctAnswer = question.correct;
                const isCorrect = arraysEqual(userAnswer.sort(), correctAnswer.sort());
                
                const resultCard = document.createElement('div');
                resultCard.className = `border rounded-lg p-4 ${isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'} fade-in`;
                resultCard.style.animationDelay = `${index * 0.1}s`;
                
                const typeText = {
                    'single': 'æŠä¸€é¸æŠ',
                    'multiple': 'è¤‡æ•°é¸æŠ',
                    'truefalse': 'â—‹Ã—å•é¡Œ'
                };
                
                let explanationHtml = '';
                if (currentUser.plan === 'premium' && question.explanation) {
                    explanationHtml = `
                        <div class="mt-4 p-3 bg-blue-50 rounded-lg border-l-4 border-blue-400">
                            <div class="flex items-start">
                                <span class="text-blue-500 mr-2 mt-1">ğŸ’¡</span>
                                <div>
                                    <h5 class="font-medium text-blue-800 mb-1">è§£èª¬</h5>
                                    <p class="text-blue-700 text-sm">${question.explanation}</p>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (currentUser.plan === 'free') {
                    explanationHtml = `
                        <div class="mt-4 p-3 bg-gray-50 rounded-lg border-l-4 border-gray-300">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <span class="text-gray-400 mr-2">ğŸ”’</span>
                                    <span class="text-gray-600 text-sm">è§£èª¬ã¯ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³é™å®šã§ã™</span>
                                </div>
                                <button onclick="showUpgradeModal()" class="text-xs bg-gradient-to-r from-purple-500 to-pink-500 text-white px-3 py-1 rounded-full hover:shadow-lg transition-all">
                                    ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
                                </button>
                            </div>
                        </div>
                    `;
                }

                resultCard.innerHTML = `
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center">
                            <span class="text-lg ${isCorrect ? 'text-green-600' : 'text-red-600'} mr-2">
                                ${isCorrect ? 'âœ…' : 'âŒ'}
                            </span>
                            <span class="font-medium text-gray-800">å•é¡Œ ${index + 1}</span>
                            <span class="ml-2 px-2 py-1 text-xs bg-blue-100 text-blue-600 rounded">${question.category || 'æœªåˆ†é¡'}</span>
                            <span class="ml-1 px-2 py-1 text-xs bg-purple-100 text-purple-600 rounded">${question.difficulty || 'æœªè¨­å®š'}</span>
                            <span class="ml-1 px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded">${typeText[question.type]}</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <p class="text-gray-800 font-medium mb-2">${question.question}</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-3">
                        <div>
                            <span class="font-medium text-gray-600">ã‚ãªãŸã®å›ç­”:</span>
                            <div class="mt-1">
                                ${userAnswer.length > 0 ? 
                                    userAnswer.map(ans => `<span class="inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded mr-1 mb-1">${ans}</span>`).join('') : 
                                    '<span class="text-gray-400">æœªå›ç­”</span>'
                                }
                            </div>
                        </div>
                        <div>
                            <span class="font-medium text-gray-600">æ­£è§£:</span>
                            <div class="mt-1">
                                ${correctAnswer.map(ans => `<span class="inline-block bg-green-100 text-green-800 px-2 py-1 rounded mr-1 mb-1">${ans}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                    ${explanationHtml}
                `;
                
                container.appendChild(resultCard);
            });
        }

        function hideDetailedResults() {
            document.getElementById('detailedResults').classList.add('hidden');
        }

        function arraysEqual(a, b) {
            return a.length === b.length && a.every((val, index) => val === b[index]);
        }

        function restartQuiz() {
            // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            document.getElementById('resultContainer').classList.add('hidden');
            document.getElementById('detailedResults').classList.add('hidden');
            document.getElementById('achievementSection').classList.add('hidden');
            document.getElementById('setupPanel').classList.remove('hidden');
            
            currentQuestionIndex = 0;
            userAnswers = [];
            selectedAnswers.clear();
            timeRemaining = 0;
            quizStartTime = null;
        }

        // ãƒ†ãƒ¼ãƒç®¡ç†
        let currentTheme = localStorage.getItem('theme') || 
                          (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');

        function initializeTheme() {
            document.documentElement.setAttribute('data-theme', currentTheme);
            updateThemeIcon();
        }

        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            localStorage.setItem('theme', currentTheme);
            updateThemeIcon();
            
            // Google Analytics ã‚¤ãƒ™ãƒ³ãƒˆ
            if (typeof gtag !== 'undefined') {
                gtag('event', 'theme_change', {
                    theme: currentTheme
                });
            }
        }

        function updateThemeIcon() {
            const icon = document.getElementById('themeIcon');
            if (icon) {
                icon.textContent = currentTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
            }
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã‚µãƒãƒ¼ãƒˆ
        function initializeKeyboardSupport() {
            document.addEventListener('keydown', function(e) {
                // ã‚¯ã‚¤ã‚ºç”»é¢ã§ã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ
                if (!document.getElementById('quizContainer').classList.contains('hidden')) {
                    const optionButtons = document.querySelectorAll('.option-button:not([disabled])');
                    
                    // æ•°å­—ã‚­ãƒ¼ (1-4) ã§é¸æŠè‚¢ã‚’é¸æŠ
                    if (e.key >= '1' && e.key <= '4') {
                        const index = parseInt(e.key) - 1;
                        if (optionButtons[index]) {
                            optionButtons[index].click();
                            e.preventDefault();
                        }
                    }
                    
                    // Enterã‚­ãƒ¼ã§æ¬¡ã®å•é¡Œã¸
                    if (e.key === 'Enter' && !document.getElementById('nextButton').disabled) {
                        document.getElementById('nextButton').click();
                        e.preventDefault();
                    }
                    
                    // Backspaceã§å‰ã®å•é¡Œã¸
                    if (e.key === 'Backspace' && !document.getElementById('prevButton').disabled) {
                        document.getElementById('prevButton').click();
                        e.preventDefault();
                    }
                }
                
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'd': // Ctrl+D ã§ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
                            toggleTheme();
                            e.preventDefault();
                            break;
                        case 'h': // Ctrl+H ã§ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
                            if (currentUser) {
                                showHome();
                                e.preventDefault();
                            }
                            break;
                    }
                }
                
                // Escã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
                if (e.key === 'Escape') {
                    const upgradeModal = document.getElementById('upgradeModal');
                    if (!upgradeModal.classList.contains('hidden')) {
                        closeUpgradeModal();
                    }
                }
            });
        }

        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†
        function manageFocus() {
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‹ã„ãŸæ™‚ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒˆãƒ©ãƒƒãƒ—
            const upgradeModal = document.getElementById('upgradeModal');
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        if (!upgradeModal.classList.contains('hidden')) {
                            // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®æœ€åˆã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¯èƒ½è¦ç´ ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
                            const firstFocusable = upgradeModal.querySelector('button, input, select, textarea, [tabindex]:not([tabindex="-1"])');
                            if (firstFocusable) {
                                firstFocusable.focus();
                            }
                        }
                    }
                });
            });
            observer.observe(upgradeModal, { attributes: true });
        }

        // Phase 2: ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ - ãƒ¬ãƒ™ãƒ«ã‚·ã‚¹ãƒ†ãƒ 
        let userLevel = JSON.parse(localStorage.getItem('userLevel') || '{"level": 1, "totalXP": 0}');
        let achievements = JSON.parse(localStorage.getItem('achievements') || '[]');
        let dailyGoals = JSON.parse(localStorage.getItem('dailyGoals') || '{}');
        let learningStreak = JSON.parse(localStorage.getItem('learningStreak') || '{"current": 0, "best": 0, "lastDate": null}');

        // ãƒ¬ãƒ™ãƒ«é–¾å€¤ï¼ˆå„ãƒ¬ãƒ™ãƒ«ã«å¿…è¦ãªç´¯è¨ˆXPï¼‰
        const levelThresholds = [
            0, 100, 250, 450, 700, 1000, 1350, 1750, 2200, 2700, 3250, 3850, 4500, 5200, 5950, 6750, 7600, 8500, 9450, 10500
        ];

        // ãƒãƒƒã‚¸å®šç¾©
        const badgeDefinitions = {
            'first_quiz': {
                name: 'åˆå›æŒ‘æˆ¦',
                description: 'åˆã‚ã¦ã‚¯ã‚¤ã‚ºã«æŒ‘æˆ¦ã—ã¾ã—ãŸ',
                icon: 'ğŸ¯',
                rarity: 'common'
            },
            'perfect_score': {
                name: 'æº€ç‚¹ç²å¾—',
                description: 'ã‚¯ã‚¤ã‚ºã§æº€ç‚¹ã‚’å–ã‚Šã¾ã—ãŸ',
                icon: 'ğŸ†',
                rarity: 'uncommon'
            },
            'streak_3': {
                name: '3æ—¥é€£ç¶š',
                description: '3æ—¥é€£ç¶šã§å­¦ç¿’ã—ã¾ã—ãŸ',
                icon: 'ğŸ”¥',
                rarity: 'uncommon'
            },
            'streak_7': {
                name: '1é€±é–“é€£ç¶š',
                description: '7æ—¥é€£ç¶šã§å­¦ç¿’ã—ã¾ã—ãŸ',
                icon: 'âš¡',
                rarity: 'rare'
            },
            'streak_30': {
                name: '1ãƒ¶æœˆé€£ç¶š',
                description: '30æ—¥é€£ç¶šã§å­¦ç¿’ã—ã¾ã—ãŸ',
                icon: 'ğŸ’',
                rarity: 'legendary'
            },
            'seo_master': {
                name: 'SEOãƒã‚¹ã‚¿ãƒ¼',
                description: 'SEOå•é¡Œã‚’10å•ä»¥ä¸Šæ­£è§£ã—ã¾ã—ãŸ',
                icon: 'ğŸ”',
                rarity: 'rare'
            },
            'ai_expert': {
                name: 'AIå°‚é–€å®¶',
                description: 'AIå•é¡Œã‚’10å•ä»¥ä¸Šæ­£è§£ã—ã¾ã—ãŸ',
                icon: 'ğŸ¤–',
                rarity: 'rare'
            },
            'early_bird': {
                name: 'æ—©èµ·ãå­¦ç¿’è€…',
                description: 'æœ6æ™‚å‰ã«å­¦ç¿’ã—ã¾ã—ãŸ',
                icon: 'ğŸŒ…',
                rarity: 'uncommon'
            },
            'night_owl': {
                name: 'å¤œæ›´ã‹ã—å­¦ç¿’è€…',
                description: 'å¤œ22æ™‚ä»¥é™ã«å­¦ç¿’ã—ã¾ã—ãŸ',
                icon: 'ğŸ¦‰',
                rarity: 'uncommon'
            },
            'comeback_kid': {
                name: 'ã‚«ãƒ ãƒãƒƒã‚¯ã‚­ãƒƒãƒ‰',
                description: '7æ—¥ã¶ã‚Šã«å­¦ç¿’ã‚’å†é–‹ã—ã¾ã—ãŸ',
                icon: 'ğŸ­',
                rarity: 'rare'
            },
            'perfectionist': {
                name: 'å®Œç’§ä¸»ç¾©è€…',
                description: '5å›é€£ç¶šã§æº€ç‚¹ã‚’å–ã‚Šã¾ã—ãŸ',
                icon: 'ğŸ’¯',
                rarity: 'epic'
            },
            'grand_master': {
                name: 'ã‚°ãƒ©ãƒ³ãƒ‰ãƒã‚¹ã‚¿ãƒ¼',
                description: 'ãƒ¬ãƒ™ãƒ«20ã«åˆ°é”ã—ã¾ã—ãŸ',
                icon: 'ğŸ‘‘',
                rarity: 'legendary'
            },
            'explorer': {
                name: 'æ¢æ¤œå®¶',
                description: 'å…¨ã‚«ãƒ†ã‚´ãƒªã®å•é¡Œã«æŒ‘æˆ¦ã—ã¾ã—ãŸ',
                icon: 'ğŸ—ºï¸',
                rarity: 'epic'
            },
            'speed_demon': {
                name: 'ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒ‡ãƒ¼ãƒ¢ãƒ³',
                description: '1å•ã‚’10ç§’ä»¥å†…ã§æ­£è§£ã—ã¾ã—ãŸ',
                icon: 'âš¡',
                rarity: 'rare'
            },
            'knowledge_seeker': {
                name: 'çŸ¥è­˜æ¢æ±‚è€…',
                description: '100å•ä»¥ä¸Šã«æŒ‘æˆ¦ã—ã¾ã—ãŸ',
                icon: 'ğŸ“š',
                rarity: 'epic'
            }
        };

        // XPè¨ˆç®—
        function calculateXP(correctCount, totalQuestions, difficulty) {
            const baseXP = correctCount * 10;
            const difficultyMultiplier = {
                'åˆç´š': 1.0,
                'ä¸­ç´š': 1.5,
                'ä¸Šç´š': 2.0,
                'æœªè¨­å®š': 1.0
            };
            const accuracyBonus = (correctCount / totalQuestions) >= 0.8 ? 20 : 0;
            
            return Math.round(baseXP * (difficultyMultiplier[difficulty] || 1.0) + accuracyBonus);
        }

        // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—å‡¦ç†
        function updateUserLevel(xpGained) {
            userLevel.totalXP += xpGained;
            
            // æ–°ã—ã„ãƒ¬ãƒ™ãƒ«ã‚’è¨ˆç®—
            let newLevel = 1;
            for (let i = levelThresholds.length - 1; i >= 0; i--) {
                if (userLevel.totalXP >= levelThresholds[i]) {
                    newLevel = i + 1;
                    break;
                }
            }
            
            const leveledUp = newLevel > userLevel.level;
            userLevel.level = newLevel;
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            localStorage.setItem('userLevel', JSON.stringify(userLevel));
            
            if (leveledUp) {
                showLevelUpNotification(newLevel);
                
                // ãƒ¬ãƒ™ãƒ«20åˆ°é”ã§ã‚°ãƒ©ãƒ³ãƒ‰ãƒã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¸
                if (newLevel === 20) {
                    awardBadge('grand_master');
                }
            }
            
            return leveledUp;
        }

        function showLevelUpNotification(newLevel) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-6 rounded-xl shadow-2xl z-50 bounce-in';
            notification.innerHTML = `
                <div class="text-center">
                    <div class="text-4xl mb-2">ğŸ‰</div>
                    <div class="text-xl font-bold mb-1">ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼</div>
                    <div class="text-2xl font-bold">Lv.${newLevel}</div>
                    <div class="text-sm opacity-90 mt-1">ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // ç´™å¹é›ªåŠ¹æœ
            createConfetti();
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // ãƒãƒƒã‚¸ç²å¾—å‡¦ç†
        function awardBadge(badgeId) {
            if (!achievements.includes(badgeId)) {
                achievements.push(badgeId);
                localStorage.setItem('achievements', JSON.stringify(achievements));
                showBadgeNotification(badgeId);
            }
        }

        function showBadgeNotification(badgeId) {
            const badge = badgeDefinitions[badgeId];
            if (!badge) return;
            
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 left-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4 rounded-xl shadow-lg z-50 bounce-in';
            notification.innerHTML = `
                <div class="flex items-center">
                    <div class="text-3xl mr-3">${badge.icon}</div>
                    <div>
                        <div class="font-bold">ãƒãƒƒã‚¸ç²å¾—ï¼</div>
                        <div class="text-sm">${badge.name}</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ãƒãƒƒã‚¸ç²å¾—ãƒã‚§ãƒƒã‚¯
        function checkAndAwardBadges(quizData) {
            const newBadges = [];
            
            // åˆå›æŒ‘æˆ¦
            if (quizHistory.length === 1) {
                awardBadge('first_quiz');
                newBadges.push('first_quiz');
            }
            
            // æº€ç‚¹ç²å¾—
            if (quizData.accuracy === 100) {
                awardBadge('perfect_score');
                newBadges.push('perfect_score');
                
                // 5å›é€£ç¶šæº€ç‚¹ãƒã‚§ãƒƒã‚¯
                const recentQuizzes = quizHistory.slice(-5);
                if (recentQuizzes.length === 5 && recentQuizzes.every(q => q.accuracy === 100)) {
                    awardBadge('perfectionist');
                    newBadges.push('perfectionist');
                }
            }
            
            // é€£ç¶šå­¦ç¿’ãƒãƒƒã‚¸
            updateLearningStreak();
            if (learningStreak.current === 3) {
                awardBadge('streak_3');
                newBadges.push('streak_3');
            } else if (learningStreak.current === 7) {
                awardBadge('streak_7');
                newBadges.push('streak_7');
            } else if (learningStreak.current === 30) {
                awardBadge('streak_30');
                newBadges.push('streak_30');
            }
            
            // ã‚«ãƒ†ã‚´ãƒªå°‚é–€ãƒãƒƒã‚¸
            const categoryStats = {};
            quizHistory.forEach(quiz => {
                quiz.questions.forEach(q => {
                    if (q.isCorrect) {
                        const category = q.category || 'æœªåˆ†é¡';
                        categoryStats[category] = (categoryStats[category] || 0) + 1;
                    }
                });
            });
            
            if (categoryStats['SEO'] >= 10) {
                awardBadge('seo_master');
                newBadges.push('seo_master');
            }
            if (categoryStats['AI'] >= 10) {
                awardBadge('ai_expert');
                newBadges.push('ai_expert');
            }
            
            // æ™‚é–“å¸¯ãƒãƒƒã‚¸
            const hour = new Date().getHours();
            if (hour < 6) {
                awardBadge('early_bird');
                newBadges.push('early_bird');
            } else if (hour >= 22) {
                awardBadge('night_owl');
                newBadges.push('night_owl');
            }
            
            // æ¢æ¤œå®¶ãƒãƒƒã‚¸ï¼ˆå…¨ã‚«ãƒ†ã‚´ãƒªæŒ‘æˆ¦ï¼‰
            const attemptedCategories = [...new Set(quizHistory.map(q => q.category))];
            const totalCategories = [...new Set(originalQuestions.map(q => q.category || 'æœªåˆ†é¡'))];
            if (attemptedCategories.length >= totalCategories.length && totalCategories.length > 0) {
                awardBadge('explorer');
                newBadges.push('explorer');
            }
            
            // çŸ¥è­˜æ¢æ±‚è€…ãƒãƒƒã‚¸
            const totalQuestionsAnswered = quizHistory.reduce((sum, quiz) => sum + quiz.total, 0);
            if (totalQuestionsAnswered >= 100) {
                awardBadge('knowledge_seeker');
                newBadges.push('knowledge_seeker');
            }
            
            return newBadges;
        }

        // å­¦ç¿’ç¶™ç¶šç®¡ç†
        function updateLearningStreak() {
            const today = new Date().toDateString();
            const lastDate = learningStreak.lastDate;
            
            if (lastDate) {
                const lastDateObj = new Date(lastDate);
                const todayObj = new Date(today);
                const diffDays = Math.floor((todayObj - lastDateObj) / (1000 * 60 * 60 * 24));
                
                if (diffDays === 1) {
                    // é€£ç¶šå­¦ç¿’
                    learningStreak.current++;
                } else if (diffDays > 1) {
                    // 7æ—¥ã¶ã‚Šã®å¾©å¸°ãƒã‚§ãƒƒã‚¯
                    if (diffDays === 7) {
                        awardBadge('comeback_kid');
                    }
                    // é€£ç¶šè¨˜éŒ²ãƒªã‚»ãƒƒãƒˆ
                    learningStreak.current = 1;
                }
                // diffDays === 0 ã®å ´åˆï¼ˆåŒæ—¥ï¼‰ã¯ä½•ã‚‚ã—ãªã„
            } else {
                // åˆå›å­¦ç¿’
                learningStreak.current = 1;
            }
            
            // æœ€é«˜è¨˜éŒ²æ›´æ–°
            if (learningStreak.current > learningStreak.best) {
                learningStreak.best = learningStreak.current;
            }
            
            learningStreak.lastDate = today;
            localStorage.setItem('learningStreak', JSON.stringify(learningStreak));
        }

        // ä»Šæ—¥ã®ç›®æ¨™ç®¡ç†
        function initializeDailyGoals() {
            const today = new Date().toDateString();
            
            if (!dailyGoals[today]) {
                dailyGoals[today] = {
                    goals: {
                        quizzes: 3,      // ã‚¯ã‚¤ã‚ºå®Œäº†æ•°
                        questions: 20,   // å•é¡Œå›ç­”æ•°
                        xp: 100         // XPç²å¾—é‡
                    },
                    progress: {
                        quizzesCompleted: 0,
                        questionsAnswered: 0,
                        xpEarned: 0
                    }
                };
                
                // å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ï¼ˆ7æ—¥ä»¥ä¸Šå‰ï¼‰
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                
                Object.keys(dailyGoals).forEach(date => {
                    if (new Date(date) < weekAgo) {
                        delete dailyGoals[date];
                    }
                });
                
                localStorage.setItem('dailyGoals', JSON.stringify(dailyGoals));
            }
        }

        function updateDailyGoals(quizData, xpGained) {
            const today = new Date().toDateString();
            initializeDailyGoals();
            
            const todayGoals = dailyGoals[today];
            todayGoals.progress.quizzesCompleted++;
            todayGoals.progress.questionsAnswered += quizData.total;
            todayGoals.progress.xpEarned += xpGained;
            
            localStorage.setItem('dailyGoals', JSON.stringify(dailyGoals));
            
            // ç›®æ¨™é”æˆãƒã‚§ãƒƒã‚¯
            checkDailyGoalCompletion(todayGoals);
        }

        function checkDailyGoalCompletion(todayGoals) {
            const { goals, progress } = todayGoals;
            
            if (progress.quizzesCompleted >= goals.quizzes && 
                progress.questionsAnswered >= goals.questions && 
                progress.xpEarned >= goals.xp) {
                
                showDailyGoalCompletionNotification();
            }
        }

        function showDailyGoalCompletionNotification() {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-gradient-to-r from-green-400 to-blue-500 text-white p-4 rounded-xl shadow-lg z-50 bounce-in';
            notification.innerHTML = `
                <div class="flex items-center">
                    <div class="text-2xl mr-3">ğŸ¯</div>
                    <div>
                        <div class="font-bold">ä»Šæ—¥ã®ç›®æ¨™é”æˆï¼</div>
                        <div class="text-sm opacity-90">ç´ æ™´ã‚‰ã—ã„å­¦ç¿’æˆæœã§ã™ï¼</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ç”»åƒç®¡ç†æ©Ÿèƒ½
        function showImageUploadModal() {
            document.getElementById('imageUploadModal').classList.remove('hidden');
            
            // ç¾åœ¨ã®ç”»åƒURLã‚’è¡¨ç¤º
            const currentImageUrl = localStorage.getItem('customHeroImageUrl');
            if (currentImageUrl) {
                document.getElementById('heroImageUrl').value = currentImageUrl;
            }
        }
        
        function closeImageUploadModal() {
            document.getElementById('imageUploadModal').classList.add('hidden');
            document.getElementById('heroImageUrl').value = '';
        }
        
        function updateHeroImage() {
            const imageUrl = document.getElementById('heroImageUrl').value.trim();
            
            if (!imageUrl) {
                alert('ç”»åƒURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // URLã®å¦¥å½“æ€§ã‚’ãƒã‚§ãƒƒã‚¯
            if (!isValidImageUrl(imageUrl)) {
                alert('æœ‰åŠ¹ãªç”»åƒURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆjpg, jpeg, png, gif, webpå½¢å¼ï¼‰');
                return;
            }
            
            // ç”»åƒã®èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
            const testImage = new Image();
            testImage.onload = function() {
                // ç”»åƒã®èª­ã¿è¾¼ã¿ãŒæˆåŠŸã—ãŸå ´åˆ
                localStorage.setItem('customHeroImageUrl', imageUrl);
                loadCustomHeroImage();
                closeImageUploadModal();
                alert('ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒã‚’æ›´æ–°ã—ã¾ã—ãŸï¼');
            };
            testImage.onerror = function() {
                alert('ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚URLã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            };
            testImage.src = imageUrl;
        }
        
        function resetToDefaultImage() {
            localStorage.removeItem('customHeroImageUrl');
            loadCustomHeroImage();
            closeImageUploadModal();
            alert('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¤ãƒ©ã‚¹ãƒˆã«æˆ»ã—ã¾ã—ãŸï¼');
        }
        
        function loadCustomHeroImage() {
            const customImageUrl = localStorage.getItem('customHeroImageUrl');
            const defaultIllustration = document.getElementById('defaultIllustration');
            const customHeroImage = document.getElementById('customHeroImage');
            
            if (customImageUrl) {
                // ã‚«ã‚¹ã‚¿ãƒ ç”»åƒã‚’è¡¨ç¤º
                customHeroImage.src = customImageUrl;
                customHeroImage.classList.remove('hidden');
                defaultIllustration.classList.add('hidden');
            } else {
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®SVGã‚¤ãƒ©ã‚¹ãƒˆã‚’è¡¨ç¤º
                customHeroImage.classList.add('hidden');
                defaultIllustration.classList.remove('hidden');
            }
        }
        
        function isValidImageUrl(url) {
            try {
                const urlObj = new URL(url);
                const pathname = urlObj.pathname.toLowerCase();
                return pathname.match(/\.(jpg|jpeg|png|gif|webp)$/);
            } catch (e) {
                return false;
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ãƒ†ãƒ¼ãƒåˆæœŸåŒ–
            initializeTheme();
            
            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚µãƒãƒ¼ãƒˆåˆæœŸåŒ–
            initializeKeyboardSupport();
            
            // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†åˆæœŸåŒ–
            manageFocus();
            
            // Phase 2: ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
            initializeDailyGoals();
            
            // ä¿å­˜ã•ã‚ŒãŸãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ç¢ºèª
            const savedUser = loadUserSession();
            if (savedUser) {
                currentUser = savedUser;
                console.log('ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒã—ã¾ã—ãŸ:', currentUser.name);
                showMainApp();
            } else {
                // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’è¡¨ç¤º
                document.getElementById('loginContainer').classList.remove('hidden');
            }
            
            // åºƒå‘Šã®åˆæœŸåŒ–
            if (typeof adsbygoogle !== 'undefined') {
                (adsbygoogle = window.adsbygoogle || []).push({});
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'967bbabfd3161450',t:'MTc1Mzk1MDU4Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
